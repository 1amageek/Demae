{"ast":null,"code":"var _jsxFileName = \"/Users/1amageek/Desktop/Demae/src/app/hooks/commerce/index.tsx\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState, createContext, useContext } from 'react';\nimport firebase from \"firebase\";\nimport \"firebase/firestore\";\nimport \"firebase/auth\";\nimport { useDocumentListen, useDataSourceListen } from '../firestore';\nimport Provider, { Role } from 'models/commerce/Provider';\nimport Product from 'models/commerce/Product';\nimport SKU from 'models/commerce/SKU';\nimport Cart from 'models/commerce/Cart';\nimport User from 'models/commerce/User';\nimport Shipping from 'models/commerce/Shipping';\nimport Order from 'models/commerce/Order';\nimport { AuthContext } from '../auth';\n\nconst _useAdmin = () => {\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    loading: true\n  });\n  useEffect(() => {\n    let enabled = true;\n    let listener = firebase.auth().onIdTokenChanged(async auth => {\n      if (auth) {\n        const result = await (auth === null || auth === void 0 ? void 0 : auth.getIdTokenResult());\n\n        if (enabled) {\n          const adminID = result.claims.admin;\n\n          if (adminID) {\n            const user = new User(auth.uid);\n            const snapshot = await user.providers.collectionReference.doc(adminID).get();\n            const role = Role.fromSnapshot(snapshot);\n            setState({\n              data: role,\n              loading: false,\n              error: undefined\n            });\n          } else {\n            setState({\n              data: undefined,\n              loading: false,\n              error: undefined\n            });\n          }\n        }\n      } else {\n        if (enabled) {\n          setState({\n            data: undefined,\n            loading: false,\n            error: undefined\n          });\n        }\n      }\n    }, error => {\n      if (enabled) {\n        setState({\n          data: undefined,\n          loading: false,\n          error: error\n        });\n      }\n    });\n    return () => {\n      enabled = false;\n      listener();\n    };\n  }, []);\n  return [state.data, state.loading, state.error];\n};\n\nexport const AdminContext = createContext([undefined, true, undefined]);\nexport const AdminProvider = ({\n  children\n}) => {\n  const [auth, isLoading, error] = _useAdmin();\n\n  return __jsx(AdminContext.Provider, {\n    value: [auth, isLoading, error],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 12\n    }\n  }, \" \", children, \" \");\n};\nexport const useAdmin = () => {\n  return useContext(AdminContext);\n}; // Admin\n\nexport const AdminProviderContext = createContext([undefined, true, undefined]);\nexport const AdminProviderProvider = ({\n  children\n}) => {\n  const [auth, waiting] = useAdmin();\n  const [data, isLoading, error] = useDocumentListen(Provider, (auth === null || auth === void 0 ? void 0 : auth.id) ? new Provider(auth.id).documentReference : undefined, waiting);\n  return __jsx(AdminProviderContext.Provider, {\n    value: [data, isLoading, error],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 12\n    }\n  }, \" \", children, \" \");\n};\nexport const AdminProviderProductContext = createContext([undefined, true, undefined]);\nexport const AdminProviderProductProvider = ({\n  id,\n  children\n}) => {\n  const {\n    0: provider,\n    1: waiting\n  } = useContext(AdminProviderContext);\n  const documentReference = provider && id ? provider === null || provider === void 0 ? void 0 : provider.products.collectionReference.doc(id) : undefined;\n  const [data, isLoading, error] = useDocumentListen(Product, documentReference, waiting);\n  return __jsx(AdminProviderProductContext.Provider, {\n    value: [data, isLoading, error],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 12\n    }\n  }, \" \", children, \" \");\n};\nexport const AdminProviderProductSKUContext = createContext([undefined, true, undefined]);\nexport const AdminProviderProductSKUProvider = ({\n  id,\n  children\n}) => {\n  const {\n    0: product,\n    1: waiting\n  } = useContext(AdminProviderProductContext);\n  const documentReference = product && id ? product.skus.collectionReference.doc(id) : undefined;\n  const [data, isLoading, error] = useDocumentListen(SKU, documentReference, waiting);\n  return __jsx(AdminProviderProductSKUContext.Provider, {\n    value: [data, isLoading, error],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 12\n    }\n  }, \" \", children, \" \");\n};\nexport const AdminProviderOrderContext = createContext([undefined, true, undefined]);\nexport const AdminProviderOrderProvider = ({\n  id,\n  children\n}) => {\n  const {\n    0: provider,\n    1: waiting\n  } = useContext(AdminProviderContext);\n  const documentReference = provider && id ? provider.orders.collectionReference.doc(id) : undefined;\n  const [data, isLoading, error] = useDocumentListen(Order, documentReference, waiting);\n  return __jsx(AdminProviderOrderContext.Provider, {\n    value: [data, isLoading, error],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 12\n    }\n  }, \" \", children, \" \");\n};\nexport const useAdminProvider = () => {\n  return useContext(AdminProviderContext);\n};\nexport const useAdminProviderProducts = () => {\n  const [provider, waiting] = useAdminProvider();\n  const collectionReference = provider ? provider.products.collectionReference : undefined;\n  return useDataSourceListen(Product, {\n    path: collectionReference === null || collectionReference === void 0 ? void 0 : collectionReference.path\n  }, waiting);\n};\nexport const useAdminProviderProduct = () => {\n  return useContext(AdminProviderProductContext);\n};\nexport const useAdminProviderProductSKUs = id => {\n  const [provider, waiting] = useAdminProvider();\n  const collectionReference = provider && id ? provider.products.collectionReference.doc(id).collection('skus') : undefined;\n  return useDataSourceListen(SKU, {\n    path: collectionReference === null || collectionReference === void 0 ? void 0 : collectionReference.path\n  }, waiting);\n};\nexport const useAdminProviderOrders = () => {\n  const [provider, waiting] = useAdminProvider();\n  const collectionReference = provider ? provider.orders.collectionReference : undefined;\n  return useDataSourceListen(Order, {\n    path: collectionReference === null || collectionReference === void 0 ? void 0 : collectionReference.path\n  }, waiting);\n};\nexport const useAdminProviderProductSKU = (productID, skuID) => {\n  const [provider, waiting] = useAdminProvider();\n  const documentReference = provider && productID && skuID ? provider.products.doc(productID, Product).skus.collectionReference.doc(skuID) : undefined;\n  return useDocumentListen(SKU, documentReference, waiting);\n};\nexport const useAdminProviderOrder = id => {\n  const [provider, waiting] = useAdminProvider();\n  const documentReference = provider && id ? provider.orders.collectionReference.doc(id) : undefined;\n  return useDocumentListen(Order, documentReference, waiting);\n}; // User\n\nexport const UserContext = createContext([undefined, true, undefined]);\nexport const UserProvider = ({\n  children\n}) => {\n  const {\n    0: auth,\n    1: waiting\n  } = useContext(AuthContext);\n  const [user, isLoading, error] = useDocumentListen(User, (auth === null || auth === void 0 ? void 0 : auth.uid) ? new User(auth.uid).documentReference : undefined, waiting);\n  return __jsx(UserContext.Provider, {\n    value: [user, isLoading, error],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 12\n    }\n  }, \" \", children, \" \");\n};\nexport const RolesContext = createContext([[], true, undefined]);\nexport const RolesProvider = ({\n  children\n}) => {\n  const {\n    0: user,\n    1: waiting\n  } = useContext(UserContext);\n  const [roles, isLoading, error] = useDataSourceListen(Role, user ? {\n    path: user.providers.collectionReference.path\n  } : undefined, waiting);\n  return __jsx(RolesContext.Provider, {\n    value: [roles, isLoading, error],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 12\n    }\n  }, \" \", children, \" \");\n};\nexport const CartContext = createContext([undefined, true, undefined]);\nexport const CartProvider = ({\n  children\n}) => {\n  const {\n    0: auth,\n    1: waiting\n  } = useContext(AuthContext);\n  const [cart, isLoading, error] = useDocumentListen(Cart, (auth === null || auth === void 0 ? void 0 : auth.uid) ? new Cart(auth.uid).documentReference : undefined, waiting);\n  return __jsx(CartContext.Provider, {\n    value: [cart, isLoading, error],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 12\n    }\n  }, \" \", children, \" \");\n};\nexport const useUserShipping = id => {\n  const {\n    0: auth,\n    1: isAuthLoading\n  } = useContext(AuthContext);\n  const collectionReference = new User(auth === null || auth === void 0 ? void 0 : auth.uid).shippingAddresses.collectionReference;\n  const {\n    0: ref\n  } = useState(id ? collectionReference.doc(id) : collectionReference.doc());\n  const [shipping, isLoading, error] = useDocumentListen(Shipping, ref, isAuthLoading);\n  return [shipping, isLoading, error];\n};\nexport const useUserShippingAddresses = () => {\n  const {\n    0: auth,\n    1: isAuthLoading\n  } = useContext(AuthContext);\n  const collectionReference = new User(auth === null || auth === void 0 ? void 0 : auth.uid).shippingAddresses.collectionReference;\n  const [data, isLoading, error] = useDataSourceListen(Shipping, {\n    path: collectionReference === null || collectionReference === void 0 ? void 0 : collectionReference.path\n  }, isAuthLoading);\n  return [data, isLoading, error];\n};\nexport const useCart = () => {\n  return useContext(CartContext);\n};\nexport const useUser = () => {\n  return useContext(UserContext);\n};\nexport const useRoles = () => {\n  return useContext(RolesContext);\n}; // Provider\n// export const ProviderContext = createContext<[Provider | undefined, boolean, Error | undefined]>([undefined, true, undefined])\n// export const ProviderProvider = ({ id, children }: { id?: string, children: any }) => {\n// \tconst [provider, isLoading, error] = useDocumentListen<Provider>(Provider, id ? new Provider(id).documentReference : undefined)\n// \treturn <ProviderContext.Provider value={[provider, isLoading, error]}> {children} </ProviderContext.Provider>\n// }\n// export const ProviderProductContext = createContext<[Product | undefined, boolean, Error | undefined]>([undefined, true, undefined])\n// export const ProviderProductProvider = ({ id, children }: { id?: string, children: any }) => {\n// \tconst [provider, waiting] = useContext(ProviderContext)\n// \tconst [product, isLoading, error] = useDocumentListen<Product>(Product, id ? provider?.products.collectionReference.doc(id) : undefined, waiting)\n// \treturn <ProviderProductContext.Provider value={[product, isLoading, error]}> {children} </ProviderProductContext.Provider>\n// }\n// export const useProvider = (): [Provider | undefined, boolean, Error | undefined] => {\n// \treturn useContext(ProviderContext)\n// }\n// export const useProviderProduct = (): [Product | undefined, boolean, Error | undefined] => {\n// \treturn useContext(ProviderProductContext)\n// }","map":{"version":3,"sources":["/Users/1amageek/Desktop/Demae/src/app/hooks/commerce/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useEffect, useState, createContext, useContext } from 'react'\r\nimport firebase from \"firebase\"\r\nimport \"firebase/firestore\"\r\nimport \"firebase/auth\"\r\nimport { useDocumentListen, useDataSourceListen } from '../firestore'\r\nimport Provider, { Role } from 'models/commerce/Provider'\r\nimport Product from 'models/commerce/Product'\r\nimport SKU from 'models/commerce/SKU'\r\nimport Cart from 'models/commerce/Cart'\r\nimport User from 'models/commerce/User'\r\nimport Shipping from 'models/commerce/Shipping'\r\nimport Order from 'models/commerce/Order'\r\nimport { AuthContext } from '../auth'\r\n\r\nconst _useAdmin = (): [Role | undefined, boolean, firebase.auth.Error?] => {\r\n\tinterface Prop {\r\n\t\tdata?: Role\r\n\t\tloading: boolean\r\n\t\terror?: firebase.auth.Error\r\n\t}\r\n\tconst [state, setState] = useState<Prop>({ loading: true })\r\n\tuseEffect(() => {\r\n\t\tlet enabled = true\r\n\t\tlet listener = firebase.auth().onIdTokenChanged(async (auth) => {\r\n\t\t\tif (auth) {\r\n\t\t\t\tconst result = await auth?.getIdTokenResult()\r\n\t\t\t\tif (enabled) {\r\n\t\t\t\t\tconst adminID = result.claims.admin\r\n\t\t\t\t\tif (adminID) {\r\n\t\t\t\t\t\tconst user: User = new User(auth.uid)\r\n\t\t\t\t\t\tconst snapshot = await user.providers.collectionReference.doc(adminID).get()\r\n\t\t\t\t\t\tconst role: Role = Role.fromSnapshot(snapshot)\r\n\t\t\t\t\t\tsetState({\r\n\t\t\t\t\t\t\tdata: role,\r\n\t\t\t\t\t\t\tloading: false,\r\n\t\t\t\t\t\t\terror: undefined\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsetState({\r\n\t\t\t\t\t\t\tdata: undefined,\r\n\t\t\t\t\t\t\tloading: false,\r\n\t\t\t\t\t\t\terror: undefined\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (enabled) {\r\n\t\t\t\t\tsetState({\r\n\t\t\t\t\t\tdata: undefined,\r\n\t\t\t\t\t\tloading: false,\r\n\t\t\t\t\t\terror: undefined\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, (error) => {\r\n\t\t\tif (enabled) {\r\n\t\t\t\tsetState({\r\n\t\t\t\t\tdata: undefined,\r\n\t\t\t\t\tloading: false,\r\n\t\t\t\t\terror: error\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn () => {\r\n\t\t\tenabled = false\r\n\t\t\tlistener()\r\n\t\t}\r\n\t}, []);\r\n\treturn [state.data, state.loading, state.error]\r\n}\r\n\r\nexport const AdminContext = createContext<[Role | undefined, boolean, firebase.auth.Error | undefined]>([undefined, true, undefined])\r\nexport const AdminProvider = ({ children }: { children: any }) => {\r\n\tconst [auth, isLoading, error] = _useAdmin()\r\n\treturn <AdminContext.Provider value={[auth, isLoading, error]}> {children} </AdminContext.Provider>\r\n}\r\n\r\nexport const useAdmin = (): [Role | undefined, boolean, firebase.auth.Error | undefined] => {\r\n\treturn useContext(AdminContext)\r\n}\r\n\r\n\r\n// Admin\r\nexport const AdminProviderContext = createContext<[Provider | undefined, boolean, Error | undefined]>([undefined, true, undefined])\r\nexport const AdminProviderProvider = ({ children }: { children: any }) => {\r\n\tconst [auth, waiting] = useAdmin()\r\n\tconst [data, isLoading, error] = useDocumentListen<Provider>(Provider, auth?.id ? new Provider(auth.id).documentReference : undefined, waiting)\r\n\treturn <AdminProviderContext.Provider value={[data, isLoading, error]}> {children} </AdminProviderContext.Provider>\r\n}\r\n\r\nexport const AdminProviderProductContext = createContext<[Product | undefined, boolean, Error | undefined]>([undefined, true, undefined])\r\nexport const AdminProviderProductProvider = ({ id, children }: { id: string, children: any }) => {\r\n\tconst [provider, waiting] = useContext(AdminProviderContext)\r\n\tconst documentReference = (provider && id) ? provider?.products.collectionReference.doc(id) : undefined\r\n\tconst [data, isLoading, error] = useDocumentListen<Product>(Product, documentReference, waiting)\r\n\treturn <AdminProviderProductContext.Provider value={[data, isLoading, error]}> {children} </AdminProviderProductContext.Provider>\r\n}\r\n\r\nexport const AdminProviderProductSKUContext = createContext<[SKU | undefined, boolean, Error | undefined]>([undefined, true, undefined])\r\nexport const AdminProviderProductSKUProvider = ({ id, children }: { id: string, children: any }) => {\r\n\tconst [product, waiting] = useContext(AdminProviderProductContext)\r\n\tconst documentReference = (product && id) ? product.skus.collectionReference.doc(id) : undefined\r\n\tconst [data, isLoading, error] = useDocumentListen<SKU>(SKU, documentReference, waiting)\r\n\treturn <AdminProviderProductSKUContext.Provider value={[data, isLoading, error]}> {children} </AdminProviderProductSKUContext.Provider>\r\n}\r\n\r\nexport const AdminProviderOrderContext = createContext<[Order | undefined, boolean, Error | undefined]>([undefined, true, undefined])\r\nexport const AdminProviderOrderProvider = ({ id, children }: { id?: string, children: any }) => {\r\n\tconst [provider, waiting] = useContext(AdminProviderContext)\r\n\tconst documentReference = (provider && id) ? provider.orders.collectionReference.doc(id) : undefined\r\n\tconst [data, isLoading, error] = useDocumentListen<Order>(Order, documentReference, waiting)\r\n\treturn <AdminProviderOrderContext.Provider value={[data, isLoading, error]}> {children} </AdminProviderOrderContext.Provider>\r\n}\r\n\r\nexport const useAdminProvider = (): [Provider | undefined, boolean, Error | undefined] => {\r\n\treturn useContext(AdminProviderContext)\r\n}\r\n\r\nexport const useAdminProviderProducts = (): [Product[], boolean, Error?] => {\r\n\tconst [provider, waiting] = useAdminProvider()\r\n\tconst collectionReference = provider ? provider.products.collectionReference : undefined\r\n\treturn useDataSourceListen<Product>(Product, { path: collectionReference?.path }, waiting)\r\n}\r\n\r\nexport const useAdminProviderProduct = (): [Product | undefined, boolean, Error | undefined] => {\r\n\treturn useContext(AdminProviderProductContext)\r\n}\r\n\r\nexport const useAdminProviderProductSKUs = (id?: string): [SKU[], boolean, Error?] => {\r\n\tconst [provider, waiting] = useAdminProvider()\r\n\tconst collectionReference = (provider && id) ? provider.products.collectionReference.doc(id).collection('skus') : undefined\r\n\treturn useDataSourceListen<SKU>(SKU, { path: collectionReference?.path }, waiting)\r\n}\r\n\r\nexport const useAdminProviderOrders = (): [Order[], boolean, Error?] => {\r\n\tconst [provider, waiting] = useAdminProvider()\r\n\tconst collectionReference = provider ? provider.orders.collectionReference : undefined\r\n\treturn useDataSourceListen<Order>(Order, { path: collectionReference?.path }, waiting)\r\n}\r\n\r\nexport const useAdminProviderProductSKU = (productID?: string, skuID?: string): [SKU | undefined, boolean, Error?] => {\r\n\tconst [provider, waiting] = useAdminProvider()\r\n\tconst documentReference = (provider && productID && skuID) ? provider.products.doc(productID, Product).skus.collectionReference.doc(skuID) : undefined\r\n\treturn useDocumentListen<SKU>(SKU, documentReference, waiting)\r\n}\r\n\r\nexport const useAdminProviderOrder = (id?: string): [Order | undefined, boolean, Error?] => {\r\n\tconst [provider, waiting] = useAdminProvider()\r\n\tconst documentReference = (provider && id) ? provider.orders.collectionReference.doc(id) : undefined\r\n\treturn useDocumentListen<Order>(Order, documentReference, waiting)\r\n}\r\n\r\n\r\n// User\r\nexport const UserContext = createContext<[User | undefined, boolean, Error | undefined]>([undefined, true, undefined])\r\nexport const UserProvider = ({ children }: { children: any }) => {\r\n\tconst [auth, waiting] = useContext(AuthContext)\r\n\tconst [user, isLoading, error] = useDocumentListen<User>(User, auth?.uid ? new User(auth.uid).documentReference : undefined, waiting)\r\n\treturn <UserContext.Provider value={[user, isLoading, error]}> {children} </UserContext.Provider>\r\n}\r\n\r\nexport const RolesContext = createContext<[Role[], boolean, Error | undefined]>([[], true, undefined])\r\nexport const RolesProvider = ({ children }: { children: any }) => {\r\n\tconst [user, waiting] = useContext(UserContext)\r\n\tconst [roles, isLoading, error] = useDataSourceListen<Role>(Role, user ? {\r\n\t\tpath: user.providers.collectionReference.path\r\n\t} : undefined, waiting)\r\n\treturn <RolesContext.Provider value={[roles, isLoading, error]}> {children} </RolesContext.Provider>\r\n}\r\n\r\nexport const CartContext = createContext<[Cart | undefined, boolean, Error | undefined]>([undefined, true, undefined])\r\nexport const CartProvider = ({ children }: { children: any }) => {\r\n\tconst [auth, waiting] = useContext(AuthContext)\r\n\tconst [cart, isLoading, error] = useDocumentListen<Cart>(Cart, auth?.uid ? new Cart(auth.uid).documentReference : undefined, waiting)\r\n\treturn <CartContext.Provider value={[cart, isLoading, error]}> {children} </CartContext.Provider>\r\n}\r\n\r\nexport const useUserShipping = (id?: string): [Shipping | undefined, boolean, Error | undefined] => {\r\n\tconst [auth, isAuthLoading] = useContext(AuthContext)\r\n\tconst collectionReference = new User(auth?.uid).shippingAddresses.collectionReference\r\n\tconst [ref] = useState(id ? collectionReference.doc(id) : collectionReference.doc())\r\n\tconst [shipping, isLoading, error] = useDocumentListen<Shipping>(Shipping, ref, isAuthLoading)\r\n\treturn [shipping, isLoading, error]\r\n}\r\n\r\nexport const useUserShippingAddresses = (): [Shipping[], boolean, Error | undefined] => {\r\n\tconst [auth, isAuthLoading] = useContext(AuthContext)\r\n\tconst collectionReference = new User(auth?.uid).shippingAddresses.collectionReference\r\n\tconst [data, isLoading, error] = useDataSourceListen<Shipping>(Shipping, { path: collectionReference?.path }, isAuthLoading)\r\n\treturn [data, isLoading, error]\r\n}\r\n\r\nexport const useCart = (): [Cart | undefined, boolean, Error | undefined] => {\r\n\treturn useContext(CartContext)\r\n}\r\n\r\nexport const useUser = (): [User | undefined, boolean, Error | undefined] => {\r\n\treturn useContext(UserContext)\r\n}\r\n\r\nexport const useRoles = (): [Role[], boolean, Error | undefined] => {\r\n\treturn useContext(RolesContext)\r\n}\r\n\r\n// Provider\r\n\r\n// export const ProviderContext = createContext<[Provider | undefined, boolean, Error | undefined]>([undefined, true, undefined])\r\n// export const ProviderProvider = ({ id, children }: { id?: string, children: any }) => {\r\n// \tconst [provider, isLoading, error] = useDocumentListen<Provider>(Provider, id ? new Provider(id).documentReference : undefined)\r\n// \treturn <ProviderContext.Provider value={[provider, isLoading, error]}> {children} </ProviderContext.Provider>\r\n// }\r\n\r\n// export const ProviderProductContext = createContext<[Product | undefined, boolean, Error | undefined]>([undefined, true, undefined])\r\n// export const ProviderProductProvider = ({ id, children }: { id?: string, children: any }) => {\r\n// \tconst [provider, waiting] = useContext(ProviderContext)\r\n// \tconst [product, isLoading, error] = useDocumentListen<Product>(Product, id ? provider?.products.collectionReference.doc(id) : undefined, waiting)\r\n// \treturn <ProviderProductContext.Provider value={[product, isLoading, error]}> {children} </ProviderProductContext.Provider>\r\n// }\r\n\r\n// export const useProvider = (): [Provider | undefined, boolean, Error | undefined] => {\r\n// \treturn useContext(ProviderContext)\r\n// }\r\n\r\n// export const useProviderProduct = (): [Product | undefined, boolean, Error | undefined] => {\r\n// \treturn useContext(ProviderProductContext)\r\n// }\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}