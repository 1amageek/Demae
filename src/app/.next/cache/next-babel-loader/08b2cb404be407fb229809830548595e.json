{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/1amageek/Desktop/Demae/src/app/components/providers/products/skus/SKUList.tsx\",\n    _s = $RefreshSig$(),\n    _this = this,\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport { Link } from 'react-router-dom';\nimport { Box, Paper, Tooltip, IconButton, ListItemAvatar, Avatar } from '@material-ui/core';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport ImageIcon from '@material-ui/icons/Image';\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\nimport RemoveCircleIcon from '@material-ui/icons/RemoveCircle';\nimport DataLoading from 'components/DataLoading';\nimport { useDataSourceListen, useDocumentListen, Where } from 'hooks/firestore';\nimport { Provider, Product, SKU } from 'models/commerce';\nimport { useCart, useUser } from 'hooks/commerce';\nimport Cart from 'models/commerce/Cart';\nimport NotFound from 'components/NotFound';\nimport Login from 'components/Login';\nimport { useDialog } from 'components/Dialog';\nimport { useModal } from 'components/Modal';\nvar useStyles = makeStyles(theme => createStyles({\n  paper: {\n    width: '100%'\n  },\n  avater: {\n    width: theme.spacing(12),\n    height: theme.spacing(12)\n  }\n}));\nexport default _s((_ref) => {\n  _s();\n\n  var {\n    providerID,\n    productID\n  } = _ref;\n  var ref = new Provider(providerID).products.doc(productID, Product).skus.collectionReference;\n  var [skus, isSKULoading] = useDataSourceListen(SKU, {\n    path: ref.path,\n    wheres: [Where('isAvailable', '==', true)],\n    limit: 100\n  });\n  var [product, isProductLoading] = useDocumentListen(Product, new Provider(providerID).products.collectionReference.doc(productID));\n\n  if (isProductLoading || isSKULoading) {\n    return __jsx(DataLoading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 17\n      }\n    });\n  }\n\n  if (!product) {\n    return __jsx(NotFound, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 16\n      }\n    });\n  }\n\n  return __jsx(Paper, {\n    elevation: 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 13\n    }\n  }, __jsx(List, {\n    dense: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 4\n    }\n  }, skus.map(sku => {\n    return __jsx(SKUListItem, {\n      key: sku.id,\n      providerID: providerID,\n      product: product,\n      sku: sku,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 46,\n        columnNumber: 17\n      }\n    });\n  })));\n}, \"WT5eUCYZRKz1JxBo8xAbFkkSDHk=\", false, function () {\n  return [useDataSourceListen, useDocumentListen];\n});\n\nvar SKUListItem = (_ref2) => {\n  _s2();\n\n  var {\n    providerID,\n    product,\n    sku\n  } = _ref2;\n  var classes = useStyles();\n  var [user] = useUser();\n  var [cart] = useCart();\n  var [setDialog] = useDialog();\n  var [setModal, modalClose] = useModal();\n  var imageURL = sku.imageURLs().length > 0 ? sku.imageURLs()[0] : undefined;\n  var amount = sku.price || 0;\n  var price = new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: sku.currency\n  }).format(amount);\n\n  var withLogin = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator(function* (sku, onNext) {\n      if (user) {\n        onNext(sku);\n      } else {\n        setDialog('Please Login', undefined, [{\n          title: 'Cancel'\n        }, {\n          title: 'OK',\n          variant: 'contained',\n          color: 'primary',\n          handler: () => {\n            setModal(__jsx(Login, {\n              onNext: /*#__PURE__*/function () {\n                var _ref4 = _asyncToGenerator(function* (user) {\n                  onNext(sku);\n                  modalClose();\n                });\n\n                return function (_x3) {\n                  return _ref4.apply(this, arguments);\n                };\n              }(),\n              __self: _this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 74,\n                columnNumber: 34\n              }\n            }));\n          }\n        }]);\n      }\n    });\n\n    return function withLogin(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var addSKU = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator(function* (sku) {\n      withLogin(sku, /*#__PURE__*/function () {\n        var _ref6 = _asyncToGenerator(function* (sku) {\n          if (!product) return;\n\n          if (user) {\n            if (cart) {\n              cart.addSKU(product, sku, providerID);\n              yield cart.save();\n            } else {\n              var _cart = new Cart(user.id);\n\n              _cart.addSKU(product, sku, providerID);\n\n              yield _cart.save();\n            }\n          }\n        });\n\n        return function (_x5) {\n          return _ref6.apply(this, arguments);\n        };\n      }());\n    });\n\n    return function addSKU(_x4) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var deleteSKU = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator(function* (sku) {\n      if (!cart) {\n        return;\n      }\n\n      cart.deleteSKU(sku, providerID);\n      yield cart.save();\n    });\n\n    return function deleteSKU(_x6) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(ListItem, {\n    button: true,\n    component: Link,\n    to: \"/providers/\".concat(providerID, \"/products/\").concat(product.id, \"/skus/\").concat(sku.id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 13\n    }\n  }, __jsx(ListItemAvatar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 4\n    }\n  }, __jsx(Avatar, {\n    className: classes.avater,\n    variant: \"rounded\",\n    src: imageURL,\n    alt: sku.name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 5\n    }\n  }, __jsx(ImageIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 6\n    }\n  }))), __jsx(ListItemText, {\n    primary: __jsx(React.Fragment, null, __jsx(Box, {\n      mx: 2,\n      my: 0,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 7\n      }\n    }, __jsx(Box, {\n      fontSize: 16,\n      fontWeight: 800,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 8\n      }\n    }, sku.name), __jsx(Box, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 8\n      }\n    }, price), __jsx(Box, {\n      color: \"text.secondary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 8\n      }\n    }, sku.caption))),\n    secondary: __jsx(React.Fragment, null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 4\n    }\n  }), __jsx(ListItemSecondaryAction, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 4\n    }\n  }, __jsx(Tooltip, {\n    title: \"Delete\",\n    onClick: e => {\n      e.stopPropagation();\n      deleteSKU(sku); // const value = Number(qty.value) - 1\n      // qty.setValue(`${Math.max(0, value)}`)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, __jsx(IconButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 6\n    }\n  }, __jsx(RemoveCircleIcon, {\n    color: \"inherit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }\n  }))), __jsx(Tooltip, {\n    title: \"Add\",\n    onClick: e => {\n      e.stopPropagation();\n      addSKU(sku); // const value = Number(qty.value) + 1\n      // qty.setValue(`${value}`)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 5\n    }\n  }, __jsx(IconButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 6\n    }\n  }, __jsx(AddCircleIcon, {\n    color: \"inherit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 7\n    }\n  })))));\n};\n\n_s2(SKUListItem, \"6gys0KdR8dR+BhkiZNiHiNUQzOM=\", false, function () {\n  return [useStyles, useUser, useCart, useDialog, useModal];\n});\n\n_c = SKUListItem;\n\nvar _c;\n\n$RefreshReg$(_c, \"SKUListItem\");","map":{"version":3,"sources":["/Users/1amageek/Desktop/Demae/src/app/components/providers/products/skus/SKUList.tsx"],"names":[],"mappings":";;;;;;;;AAAA,OAAO,KAAP,MAAkC,OAAlC;AACA,SAAS,YAAT,EAA8B,UAA9B,QAAgD,0BAAhD;AACA,SAAS,IAAT,QAAqB,kBAArB;AACA,SAAS,GAAT,EAAc,KAAd,EAAiC,OAAjC,EAA0C,UAA1C,EAAsD,cAAtD,EAAsE,MAAtE,QAA4F,mBAA5F;AACA,OAAO,IAAP,MAAiB,wBAAjB;AACA,OAAO,QAAP,MAAqB,4BAArB;AACA,OAAO,uBAAP,MAAoC,2CAApC;AACA,OAAO,YAAP,MAAyB,gCAAzB;AACA,OAAO,SAAP,MAAsB,0BAAtB;AACA,OAAO,aAAP,MAA0B,8BAA1B;AACA,OAAO,gBAAP,MAA6B,iCAA7B;AACA,OAAO,WAAP,MAAwB,wBAAxB;AACA,SAAS,mBAAT,EAA8B,iBAA9B,EAAiD,KAAjD,QAA8D,iBAA9D;AACA,SAAS,QAAT,EAAmB,OAAnB,EAA4B,GAA5B,QAAuC,iBAAvC;AACA,SAAS,OAAT,EAAkB,OAAlB,QAAiC,gBAAjC;AACA,OAAO,IAAP,MAAiB,sBAAjB;AACA,OAAO,QAAP,MAAqB,qBAArB;AACA,OAAO,KAAP,MAAkB,kBAAlB;AACA,SAAS,SAAT,QAA0B,mBAA1B;AACA,SAAS,QAAT,QAAyB,kBAAzB;AAEA,IAAM,SAAS,GAAG,UAAU,CAAE,KAAD,IAC5B,YAAY,CAAC;AACZ,EAAA,KAAK,EAAE;AACN,IAAA,KAAK,EAAE;AADD,GADK;AAIZ,EAAA,MAAM,EAAE;AACP,IAAA,KAAK,EAAE,KAAK,CAAC,OAAN,CAAc,EAAd,CADA;AAEP,IAAA,MAAM,EAAE,KAAK,CAAC,OAAN,CAAc,EAAd;AAFD;AAJI,CAAD,CADe,CAA5B;AAYA,kBAAe,UAAyE;AAAA;;AAAA,MAAxE;AAAE,IAAA,UAAF;AAAc,IAAA;AAAd,GAAwE;AAEvF,MAAM,GAAG,GAAG,IAAI,QAAJ,CAAa,UAAb,EACV,QADU,CACD,GADC,CACG,SADH,EACc,OADd,EAEV,IAFU,CAGV,mBAHF;AAKA,MAAM,CAAC,IAAD,EAAO,YAAP,IAAuB,mBAAmB,CAAM,GAAN,EAAW;AAAE,IAAA,IAAI,EAAE,GAAG,CAAC,IAAZ;AAAkB,IAAA,MAAM,EAAE,CAAC,KAAK,CAAC,aAAD,EAAgB,IAAhB,EAAsB,IAAtB,CAAN,CAA1B;AAA8D,IAAA,KAAK,EAAE;AAArE,GAAX,CAAhD;AACA,MAAM,CAAC,OAAD,EAAU,gBAAV,IAA8B,iBAAiB,CAAU,OAAV,EAAmB,IAAI,QAAJ,CAAa,UAAb,EAAyB,QAAzB,CAAkC,mBAAlC,CAAsD,GAAtD,CAA0D,SAA1D,CAAnB,CAArD;;AAEA,MAAI,gBAAgB,IAAI,YAAxB,EAAsC;AACrC,WACC,MAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD;AAGA;;AAED,MAAI,CAAC,OAAL,EAAc;AACb,WAAO,MAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAP;AACA;;AAED,SACC,MAAC,KAAD;AAAO,IAAA,SAAS,EAAE,CAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,IAAD;AAAM,IAAA,KAAK,MAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,IAAI,CAAC,GAAL,CAAS,GAAG,IAAG;AACf,WACC,MAAC,WAAD;AAAa,MAAA,GAAG,EAAE,GAAG,CAAC,EAAtB;AAA0B,MAAA,UAAU,EAAE,UAAtC;AAAkD,MAAA,OAAO,EAAE,OAA3D;AAAoE,MAAA,GAAG,EAAE,GAAzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD;AAGA,GAJA,CADF,CADD,CADD;AAWA,CA/BD;AAAA,UAO8B,mBAP9B,EAQqC,iBARrC;AAAA;;AAiCA,IAAM,WAAW,GAAG,WAAqF;AAAA;;AAAA,MAApF;AAAE,IAAA,UAAF;AAAc,IAAA,OAAd;AAAuB,IAAA;AAAvB,GAAoF;AACxG,MAAM,OAAO,GAAG,SAAS,EAAzB;AACA,MAAM,CAAC,IAAD,IAAS,OAAO,EAAtB;AACA,MAAM,CAAC,IAAD,IAAS,OAAO,EAAtB;AACA,MAAM,CAAC,SAAD,IAAc,SAAS,EAA7B;AACA,MAAM,CAAC,QAAD,EAAW,UAAX,IAAyB,QAAQ,EAAvC;AAEA,MAAM,QAAQ,GAAI,GAAG,CAAC,SAAJ,GAAgB,MAAhB,GAAyB,CAA1B,GAA+B,GAAG,CAAC,SAAJ,GAAgB,CAAhB,CAA/B,GAAoD,SAArE;AACA,MAAM,MAAM,GAAG,GAAG,CAAC,KAAJ,IAAa,CAA5B;AACA,MAAM,KAAK,GAAG,IAAI,IAAI,CAAC,YAAT,CAAsB,OAAtB,EAA+B;AAAE,IAAA,KAAK,EAAE,UAAT;AAAqB,IAAA,QAAQ,EAAE,GAAG,CAAC;AAAnC,GAA/B,EAA8E,MAA9E,CAAqF,MAArF,CAAd;;AAEA,MAAM,SAAS;AAAA,kCAAG,WAAO,GAAP,EAAiB,MAAjB,EAA+C;AAChE,UAAI,IAAJ,EAAU;AACT,QAAA,MAAM,CAAC,GAAD,CAAN;AACA,OAFD,MAEO;AACN,QAAA,SAAS,CAAC,cAAD,EAAiB,SAAjB,EAA4B,CACpC;AACC,UAAA,KAAK,EAAE;AADR,SADoC,EAIpC;AACC,UAAA,KAAK,EAAE,IADR;AAEC,UAAA,OAAO,EAAE,WAFV;AAGC,UAAA,KAAK,EAAE,SAHR;AAIC,UAAA,OAAO,EAAE,MAAK;AACb,YAAA,QAAQ,CAAC,MAAC,KAAD;AAAO,cAAA,MAAM;AAAA,8CAAE,WAAO,IAAP,EAAe;AACtC,kBAAA,MAAM,CAAC,GAAD,CAAN;AACA,kBAAA,UAAU;AACV,iBAHqB;;AAAA;AAAA;AAAA;AAAA,iBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAD,CAAR;AAIA;AATF,SAJoC,CAA5B,CAAT;AAgBA;AACD,KArBc;;AAAA,oBAAT,SAAS;AAAA;AAAA;AAAA,KAAf;;AAuBA,MAAM,MAAM;AAAA,kCAAG,WAAO,GAAP,EAAmB;AACjC,MAAA,SAAS,CAAC,GAAD;AAAA,sCAAM,WAAO,GAAP,EAAc;AAC5B,cAAI,CAAC,OAAL,EAAc;;AACd,cAAI,IAAJ,EAAU;AACT,gBAAI,IAAJ,EAAU;AACT,cAAA,IAAI,CAAC,MAAL,CAAY,OAAZ,EAAqB,GAArB,EAA0B,UAA1B;AACA,oBAAM,IAAI,CAAC,IAAL,EAAN;AACA,aAHD,MAGO;AACN,kBAAM,KAAI,GAAG,IAAI,IAAJ,CAAS,IAAI,CAAC,EAAd,CAAb;;AACA,cAAA,KAAI,CAAC,MAAL,CAAY,OAAZ,EAAqB,GAArB,EAA0B,UAA1B;;AACA,oBAAM,KAAI,CAAC,IAAL,EAAN;AACA;AACD;AACD,SAZQ;;AAAA;AAAA;AAAA;AAAA,UAAT;AAaA,KAdW;;AAAA,oBAAN,MAAM;AAAA;AAAA;AAAA,KAAZ;;AAgBA,MAAM,SAAS;AAAA,kCAAG,WAAO,GAAP,EAAmB;AACpC,UAAI,CAAC,IAAL,EAAW;AAAE;AAAQ;;AACrB,MAAA,IAAI,CAAC,SAAL,CAAe,GAAf,EAAoB,UAApB;AACA,YAAM,IAAI,CAAC,IAAL,EAAN;AACA,KAJc;;AAAA,oBAAT,SAAS;AAAA;AAAA;AAAA,KAAf;;AAMA,SACC,MAAC,QAAD;AAAU,IAAA,MAAM,MAAhB;AAAiB,IAAA,SAAS,EAAE,IAA5B;AAAkC,IAAA,EAAE,uBAAgB,UAAhB,uBAAuC,OAAO,CAAC,EAA/C,mBAA0D,GAAG,CAAC,EAA9D,CAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,MAAD;AAAQ,IAAA,SAAS,EAAE,OAAO,CAAC,MAA3B;AAAmC,IAAA,OAAO,EAAC,SAA3C;AAAqD,IAAA,GAAG,EAAE,QAA1D;AAAoE,IAAA,GAAG,EAAE,GAAG,CAAC,IAA7E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADD,CADD,CADD,EAMC,MAAC,YAAD;AACC,IAAA,OAAO,EACN,4BACC,MAAC,GAAD;AAAK,MAAA,EAAE,EAAE,CAAT;AAAY,MAAA,EAAE,EAAE,CAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,MAAC,GAAD;AAAK,MAAA,QAAQ,EAAE,EAAf;AAAmB,MAAA,UAAU,EAAE,GAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,GAAG,CAAC,IADN,CADD,EAIC,MAAC,GAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,KADF,CAJD,EAOC,MAAC,GAAD;AAAK,MAAA,KAAK,EAAC,gBAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,GAAG,CAAC,OADN,CAPD,CADD,CAFF;AAgBC,IAAA,SAAS,EACR,2BAjBF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAND,EA6BC,MAAC,uBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,OAAD;AAAS,IAAA,KAAK,EAAC,QAAf;AAAwB,IAAA,OAAO,EAAG,CAAD,IAAM;AACtC,MAAA,CAAC,CAAC,eAAF;AACA,MAAA,SAAS,CAAC,GAAD,CAAT,CAFsC,CAGtC;AACA;AACA,KALD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMC,MAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,gBAAD;AAAkB,IAAA,KAAK,EAAC,SAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADD,CAND,CADD,EAWC,MAAC,OAAD;AAAS,IAAA,KAAK,EAAC,KAAf;AAAqB,IAAA,OAAO,EAAG,CAAD,IAAM;AACnC,MAAA,CAAC,CAAC,eAAF;AACA,MAAA,MAAM,CAAC,GAAD,CAAN,CAFmC,CAGnC;AACA;AACA,KALD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMC,MAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,aAAD;AAAe,IAAA,KAAK,EAAC,SAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADD,CAND,CAXD,CA7BD,CADD;AAsDA,CA9GD;;IAAM,W;UACW,S,EACD,O,EACA,O,EACK,S,EACW,Q;;;KAL1B,W","sourcesContent":["import React, { useContext } from 'react';\r\nimport { createStyles, Theme, makeStyles } from '@material-ui/core/styles';\r\nimport { Link } from 'react-router-dom'\r\nimport { Box, Paper, Typography, Tooltip, IconButton, ListItemAvatar, Avatar, Button } from '@material-ui/core';\r\nimport List from '@material-ui/core/List';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport ImageIcon from '@material-ui/icons/Image';\r\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\r\nimport RemoveCircleIcon from '@material-ui/icons/RemoveCircle';\r\nimport DataLoading from 'components/DataLoading';\r\nimport { useDataSourceListen, useDocumentListen, Where } from 'hooks/firestore';\r\nimport { Provider, Product, SKU } from 'models/commerce';\r\nimport { useCart, useUser } from 'hooks/commerce'\r\nimport Cart from 'models/commerce/Cart';\r\nimport NotFound from 'components/NotFound'\r\nimport Login from 'components/Login'\r\nimport { useDialog } from 'components/Dialog'\r\nimport { useModal } from 'components/Modal';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n\tcreateStyles({\r\n\t\tpaper: {\r\n\t\t\twidth: '100%'\r\n\t\t},\r\n\t\tavater: {\r\n\t\t\twidth: theme.spacing(12),\r\n\t\t\theight: theme.spacing(12),\r\n\t\t}\r\n\t}),\r\n);\r\n\r\nexport default ({ providerID, productID }: { providerID: string, productID: string }) => {\r\n\r\n\tconst ref = new Provider(providerID)\r\n\t\t.products.doc(productID, Product)\r\n\t\t.skus\r\n\t\t.collectionReference\r\n\r\n\tconst [skus, isSKULoading] = useDataSourceListen<SKU>(SKU, { path: ref.path, wheres: [Where('isAvailable', '==', true)], limit: 100 })\r\n\tconst [product, isProductLoading] = useDocumentListen<Product>(Product, new Provider(providerID).products.collectionReference.doc(productID))\r\n\r\n\tif (isProductLoading || isSKULoading) {\r\n\t\treturn (\r\n\t\t\t<DataLoading />\r\n\t\t)\r\n\t}\r\n\r\n\tif (!product) {\r\n\t\treturn <NotFound />\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Paper elevation={0}>\r\n\t\t\t<List dense>\r\n\t\t\t\t{skus.map(sku => {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<SKUListItem key={sku.id} providerID={providerID} product={product} sku={sku} />\r\n\t\t\t\t\t)\r\n\t\t\t\t})}\r\n\t\t\t</List>\r\n\t\t</Paper>\r\n\t)\r\n}\r\n\r\nconst SKUListItem = ({ providerID, product, sku }: { providerID: string, product: Product, sku: SKU }) => {\r\n\tconst classes = useStyles()\r\n\tconst [user] = useUser()\r\n\tconst [cart] = useCart()\r\n\tconst [setDialog] = useDialog()\r\n\tconst [setModal, modalClose] = useModal()\r\n\r\n\tconst imageURL = (sku.imageURLs().length > 0) ? sku.imageURLs()[0] : undefined\r\n\tconst amount = sku.price || 0\r\n\tconst price = new Intl.NumberFormat('ja-JP', { style: 'currency', currency: sku.currency }).format(amount)\r\n\r\n\tconst withLogin = async (sku: SKU, onNext: (sku: SKU) => void) => {\r\n\t\tif (user) {\r\n\t\t\tonNext(sku)\r\n\t\t} else {\r\n\t\t\tsetDialog('Please Login', undefined, [\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Cancel',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'OK',\r\n\t\t\t\t\tvariant: 'contained',\r\n\t\t\t\t\tcolor: 'primary',\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tsetModal(<Login onNext={async (user) => {\r\n\t\t\t\t\t\t\tonNext(sku)\r\n\t\t\t\t\t\t\tmodalClose()\r\n\t\t\t\t\t\t}} />)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t])\r\n\t\t}\r\n\t}\r\n\r\n\tconst addSKU = async (sku: SKU) => {\r\n\t\twithLogin(sku, async (sku) => {\r\n\t\t\tif (!product) return\r\n\t\t\tif (user) {\r\n\t\t\t\tif (cart) {\r\n\t\t\t\t\tcart.addSKU(product, sku, providerID)\r\n\t\t\t\t\tawait cart.save()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst cart = new Cart(user.id)\r\n\t\t\t\t\tcart.addSKU(product, sku, providerID)\r\n\t\t\t\t\tawait cart.save()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst deleteSKU = async (sku: SKU) => {\r\n\t\tif (!cart) { return }\r\n\t\tcart.deleteSKU(sku, providerID)\r\n\t\tawait cart.save()\r\n\t}\r\n\r\n\treturn (\r\n\t\t<ListItem button component={Link} to={`/providers/${providerID}/products/${product.id}/skus/${sku.id}`}>\r\n\t\t\t<ListItemAvatar>\r\n\t\t\t\t<Avatar className={classes.avater} variant=\"rounded\" src={imageURL} alt={sku.name}>\r\n\t\t\t\t\t<ImageIcon />\r\n\t\t\t\t</Avatar>\r\n\t\t\t</ListItemAvatar>\r\n\t\t\t<ListItemText\r\n\t\t\t\tprimary={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<Box mx={2} my={0} >\r\n\t\t\t\t\t\t\t<Box fontSize={16} fontWeight={800}>\r\n\t\t\t\t\t\t\t\t{sku.name}\r\n\t\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t\t<Box>\r\n\t\t\t\t\t\t\t\t{price}\r\n\t\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t\t<Box color='text.secondary'>\r\n\t\t\t\t\t\t\t\t{sku.caption}\r\n\t\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t\tsecondary={\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t{/* <Box fontWeight=\"fontWeightMedium\" fontSize=\"subtitle1\" mx={2} my={0} >\r\n\t\t\t\t\t\t\t\t{`${ISO4217[product.currency]['symbol']}${item.subtotal().toLocaleString()}`}\r\n\t\t\t\t\t\t\t</Box> */}\r\n\t\t\t\t\t</>\r\n\t\t\t\t} />\r\n\t\t\t<ListItemSecondaryAction>\r\n\t\t\t\t<Tooltip title='Delete' onClick={(e) => {\r\n\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\tdeleteSKU(sku)\r\n\t\t\t\t\t// const value = Number(qty.value) - 1\r\n\t\t\t\t\t// qty.setValue(`${Math.max(0, value)}`)\r\n\t\t\t\t}}>\r\n\t\t\t\t\t<IconButton>\r\n\t\t\t\t\t\t<RemoveCircleIcon color='inherit' />\r\n\t\t\t\t\t</IconButton>\r\n\t\t\t\t</Tooltip>\r\n\t\t\t\t<Tooltip title='Add' onClick={(e) => {\r\n\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\taddSKU(sku)\r\n\t\t\t\t\t// const value = Number(qty.value) + 1\r\n\t\t\t\t\t// qty.setValue(`${value}`)\r\n\t\t\t\t}}>\r\n\t\t\t\t\t<IconButton>\r\n\t\t\t\t\t\t<AddCircleIcon color='inherit' />\r\n\t\t\t\t\t</IconButton>\r\n\t\t\t\t</Tooltip>\r\n\t\t\t</ListItemSecondaryAction>\r\n\t\t</ListItem>\r\n\t)\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}