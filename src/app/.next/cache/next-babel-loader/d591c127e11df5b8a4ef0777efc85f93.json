{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/1amageek/Desktop/Demae/src/app/components/providers/products/skus/SKU.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { Button, Box, Grid, Avatar, Paper, Container } from '@material-ui/core';\nimport ImageIcon from '@material-ui/icons/Image';\nimport { Provider, Product, SKU, Cart } from 'models/commerce';\nimport DataLoading from 'components/DataLoading';\nimport NotFound from 'components/NotFound';\nimport Login from 'components/Login';\nimport AddBoxIcon from '@material-ui/icons/AddBox';\nimport PaymentIcon from '@material-ui/icons/Payment';\nimport { useDocumentListen } from 'hooks/firestore';\nimport { useCart, useUser } from 'hooks/commerce';\nimport { useDialog } from 'components/Dialog';\nimport { useModal } from 'components/Modal';\nimport { useDrawer } from 'components/Drawer';\nimport { useHistory } from 'react-router-dom';\nimport QuickCheckout from 'components/checkout/checkout';\nexport default _s((_ref) => {\n  _s();\n\n  var {\n    providerID,\n    productID,\n    skuID\n  } = _ref;\n  var history = useHistory();\n  var [user] = useUser();\n  var [cart] = useCart();\n  var [setDialog] = useDialog();\n  var [setModal, modalClose] = useModal();\n  var [showDrawer, onClose] = useDrawer();\n  var provider = new Provider(providerID);\n  var [product, isProductLoading] = useDocumentListen(Product, provider.products.collectionReference.doc(productID));\n  var [sku, isLoading] = useDocumentListen(SKU, provider.products.doc(productID, Product).skus.collectionReference.doc(skuID));\n  var imageURL = ((sku === null || sku === void 0 ? void 0 : sku.imageURLs()) || []).length > 0 ? sku === null || sku === void 0 ? void 0 : sku.imageURLs()[0] : undefined;\n  var amount = (sku === null || sku === void 0 ? void 0 : sku.price) || 0;\n  var price = new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: (sku === null || sku === void 0 ? void 0 : sku.currency) || 'USD'\n  }).format(amount);\n\n  var withLogin = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator(function* (sku, onNext) {\n      if (user) {\n        onNext(sku);\n      } else {\n        setDialog('Please Login', undefined, [{\n          title: 'Cancel'\n        }, {\n          title: 'OK',\n          variant: 'contained',\n          color: 'primary',\n          handler: () => {\n            setModal(__jsx(Login, {\n              onNext: /*#__PURE__*/function () {\n                var _ref3 = _asyncToGenerator(function* (user) {\n                  onNext(sku);\n                  modalClose();\n                });\n\n                return function (_x3) {\n                  return _ref3.apply(this, arguments);\n                };\n              }(),\n              __self: _this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 44,\n                columnNumber: 34\n              }\n            }));\n          }\n        }]);\n      }\n    });\n\n    return function withLogin(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var addSKU = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator(function* (sku) {\n      withLogin(sku, /*#__PURE__*/function () {\n        var _ref5 = _asyncToGenerator(function* (sku) {\n          if (!product) return;\n\n          if (user) {\n            if (cart) {\n              cart.addSKU(product, sku, providerID);\n              yield cart.save();\n            } else {\n              var _cart = new Cart(user.id);\n\n              _cart.addSKU(product, sku, providerID);\n\n              yield _cart.save();\n            }\n          }\n        });\n\n        return function (_x5) {\n          return _ref5.apply(this, arguments);\n        };\n      }());\n    });\n\n    return function addSKU(_x4) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  if (isLoading || isProductLoading) {\n    return __jsx(Container, {\n      maxWidth: \"sm\",\n      disableGutters: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 17\n      }\n    }, __jsx(DataLoading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 5\n      }\n    }));\n  }\n\n  if (!sku || !product) {\n    return __jsx(Container, {\n      maxWidth: \"sm\",\n      disableGutters: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 17\n      }\n    }, __jsx(NotFound, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 5\n      }\n    }));\n  }\n\n  return __jsx(React.Fragment, null, __jsx(Container, {\n    maxWidth: \"sm\",\n    disableGutters: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 4\n    }\n  }, __jsx(Box, {\n    width: \"100%\",\n    height: \"100%\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 5\n    }\n  }, __jsx(Avatar, {\n    variant: \"square\",\n    src: imageURL,\n    alt: sku.name,\n    style: {\n      minHeight: \"200px\",\n      height: '100%',\n      width: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 6\n    }\n  }, __jsx(ImageIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }\n  }))), __jsx(Box, {\n    padding: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 5\n    }\n  }, __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 6\n    }\n  }, __jsx(Box, {\n    fontSize: 22,\n    fontWeight: 800,\n    paddingY: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }\n  }, sku.name), __jsx(Box, {\n    fontSize: 18,\n    fontWeight: 600,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }\n  }, sku.caption), __jsx(Box, {\n    fontSize: 18,\n    fontWeight: 600,\n    color: \"text.secondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }, price), __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }\n  }, sku.description)))), __jsx(Box, {\n    zIndex: 1050,\n    position: \"fixed\",\n    bottom: 58,\n    width: \"100%\",\n    padding: 1,\n    display: \"flex\",\n    justifyContent: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 4\n    }\n  }, __jsx(Container, {\n    maxWidth: \"sm\",\n    disableGutters: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 5\n    }\n  }, __jsx(Paper, {\n    elevation: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 6\n    }\n  }, __jsx(Box, {\n    padding: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 8\n    }\n  }, __jsx(Grid, {\n    item: true,\n    xs: 5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }, __jsx(Button, {\n    fullWidth: true,\n    size: \"large\",\n    style: {\n      fontSize: '13px'\n    },\n    startIcon: __jsx(AddBoxIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 81\n      }\n    }),\n    onClick: e => {\n      e.preventDefault();\n      addSKU(sku);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 10\n    }\n  }, \"Add to cart\")), __jsx(Grid, {\n    item: true,\n    xs: 7,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, __jsx(Button, {\n    fullWidth: true,\n    variant: \"contained\",\n    color: \"primary\",\n    size: \"large\",\n    style: {\n      fontSize: '13px'\n    },\n    startIcon: __jsx(PaymentIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 117\n      }\n    }),\n    onClick: e => {\n      e.preventDefault();\n\n      if (user) {\n        cart === null || cart === void 0 ? void 0 : cart.setSKU(product, sku, 'quick');\n        cart === null || cart === void 0 ? void 0 : cart.save();\n        showDrawer(__jsx(QuickCheckout, {\n          groupID: 'quick',\n          onClose: onClose,\n          onComplete: () => {\n            onClose();\n            history.push(\"/checkout/\".concat(providerID, \"/completed\"));\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 24\n          }\n        }));\n      } else {\n        setDialog('Welcome ðŸŽ‰', 'Please log in first to purchase this product.', [{\n          title: 'OK',\n          handler: () => {\n            setModal(__jsx(Login, {\n              onNext: () => {\n                modalClose();\n              },\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 136,\n                columnNumber: 34\n              }\n            }));\n          }\n        }]);\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 10\n    }\n  }, \"Purchase now\"))))))));\n}, \"uVFSk0+PZ4YfaYGti6n82jmmex4=\", false, function () {\n  return [useHistory, useUser, useCart, useDialog, useModal, useDrawer, useDocumentListen, useDocumentListen];\n});","map":{"version":3,"sources":["/Users/1amageek/Desktop/Demae/src/app/components/providers/products/skus/SKU.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Button, Box, Grid, Avatar, Paper, Container } from '@material-ui/core';\r\nimport ImageIcon from '@material-ui/icons/Image';\r\nimport { Provider, Product, SKU, Cart } from 'models/commerce';\r\nimport DataLoading from 'components/DataLoading';\r\nimport NotFound from 'components/NotFound'\r\nimport Login from 'components/Login'\r\nimport AddBoxIcon from '@material-ui/icons/AddBox';\r\nimport PaymentIcon from '@material-ui/icons/Payment';\r\nimport { useDocumentListen } from 'hooks/firestore';\r\nimport { useCart, useUser } from 'hooks/commerce'\r\nimport { useDialog } from 'components/Dialog'\r\nimport { useModal } from 'components/Modal';\r\nimport { useDrawer } from 'components/Drawer';\r\nimport { useHistory } from 'react-router-dom';\r\nimport QuickCheckout from 'components/checkout/checkout'\r\n\r\n\r\nexport default ({ providerID, productID, skuID }: { providerID: string, productID: string, skuID: string }) => {\r\n\r\n\tconst history = useHistory()\r\n\tconst [user] = useUser()\r\n\tconst [cart] = useCart()\r\n\tconst [setDialog] = useDialog()\r\n\tconst [setModal, modalClose] = useModal()\r\n\tconst [showDrawer, onClose] = useDrawer()\r\n\r\n\tconst provider: Provider = new Provider(providerID)\r\n\tconst [product, isProductLoading] = useDocumentListen<Product>(Product, provider.products.collectionReference.doc(productID))\r\n\tconst [sku, isLoading] = useDocumentListen<SKU>(SKU, provider.products.doc(productID, Product).skus.collectionReference.doc(skuID))\r\n\tconst imageURL = (sku?.imageURLs() || []).length > 0 ? sku?.imageURLs()[0] : undefined\r\n\r\n\tconst amount = sku?.price || 0\r\n\tconst price = new Intl.NumberFormat('ja-JP', { style: 'currency', currency: sku?.currency || 'USD' }).format(amount)\r\n\r\n\tconst withLogin = async (sku: SKU, onNext: (sku: SKU) => void) => {\r\n\t\tif (user) {\r\n\t\t\tonNext(sku)\r\n\t\t} else {\r\n\t\t\tsetDialog('Please Login', undefined, [\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Cancel',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'OK',\r\n\t\t\t\t\tvariant: 'contained',\r\n\t\t\t\t\tcolor: 'primary',\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tsetModal(<Login onNext={async (user) => {\r\n\t\t\t\t\t\t\tonNext(sku)\r\n\t\t\t\t\t\t\tmodalClose()\r\n\t\t\t\t\t\t}} />)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t])\r\n\t\t}\r\n\t}\r\n\r\n\tconst addSKU = async (sku: SKU) => {\r\n\t\twithLogin(sku, async (sku) => {\r\n\t\t\tif (!product) return\r\n\t\t\tif (user) {\r\n\t\t\t\tif (cart) {\r\n\t\t\t\t\tcart.addSKU(product, sku, providerID)\r\n\t\t\t\t\tawait cart.save()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst cart = new Cart(user.id)\r\n\t\t\t\t\tcart.addSKU(product, sku, providerID)\r\n\t\t\t\t\tawait cart.save()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tif (isLoading || isProductLoading) {\r\n\t\treturn (\r\n\t\t\t<Container maxWidth='sm' disableGutters>\r\n\t\t\t\t<DataLoading />\r\n\t\t\t</Container>\r\n\t\t)\r\n\t}\r\n\tif (!sku || !product) {\r\n\t\treturn (\r\n\t\t\t<Container maxWidth='sm' disableGutters>\r\n\t\t\t\t<NotFound />\r\n\t\t\t</Container>\r\n\t\t)\r\n\t}\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Container maxWidth='sm' disableGutters>\r\n\t\t\t\t<Box\r\n\t\t\t\t\twidth=\"100%\"\r\n\t\t\t\t\theight=\"100%\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<Avatar variant=\"square\" src={imageURL} alt={sku.name} style={{\r\n\t\t\t\t\t\tminHeight: \"200px\",\r\n\t\t\t\t\t\theight: '100%',\r\n\t\t\t\t\t\twidth: '100%'\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\t<ImageIcon />\r\n\t\t\t\t\t</Avatar>\r\n\t\t\t\t</Box>\r\n\t\t\t\t<Box padding={2}>\r\n\t\t\t\t\t<Box>\r\n\t\t\t\t\t\t<Box fontSize={22} fontWeight={800} paddingY={1}>\r\n\t\t\t\t\t\t\t{sku.name}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t<Box fontSize={18} fontWeight={600}>\r\n\t\t\t\t\t\t\t{sku.caption}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t<Box fontSize={18} fontWeight={600} color=\"text.secondary\">\r\n\t\t\t\t\t\t\t{price}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t<Box>\r\n\t\t\t\t\t\t\t{sku.description}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t</Box>\r\n\t\t\t\t</Box>\r\n\t\t\t</Container>\r\n\r\n\t\t\t<Box\r\n\t\t\t\tzIndex={1050}\r\n\t\t\t\tposition='fixed'\r\n\t\t\t\tbottom={58}\r\n\t\t\t\twidth='100%'\r\n\t\t\t\tpadding={1}\r\n\t\t\t\tdisplay='flex'\r\n\t\t\t\tjustifyContent='center'\r\n\t\t\t>\r\n\t\t\t\t<Container maxWidth='sm' disableGutters>\r\n\t\t\t\t\t<Paper elevation={3}>\r\n\t\t\t\t\t\t<Box padding={1}>\r\n\t\t\t\t\t\t\t<Grid container spacing={1}>\r\n\t\t\t\t\t\t\t\t<Grid item xs={5}>\r\n\t\t\t\t\t\t\t\t\t<Button fullWidth\r\n\t\t\t\t\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: '13px' }}\r\n\t\t\t\t\t\t\t\t\t\tstartIcon={\r\n\t\t\t\t\t\t\t\t\t\t\t<AddBoxIcon />\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\t\t\t\t\t\taddSKU(sku)\r\n\t\t\t\t\t\t\t\t\t\t}}>Add to cart</Button>\r\n\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t\t<Grid item xs={7}>\r\n\t\t\t\t\t\t\t\t\t<Button fullWidth\r\n\t\t\t\t\t\t\t\t\t\tvariant='contained'\r\n\t\t\t\t\t\t\t\t\t\tcolor='primary'\r\n\t\t\t\t\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: '13px' }}\r\n\t\t\t\t\t\t\t\t\t\tstartIcon={\r\n\t\t\t\t\t\t\t\t\t\t\t<PaymentIcon />\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\t\t\t\t\t\tif (user) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tcart?.setSKU(product, sku, 'quick')\r\n\t\t\t\t\t\t\t\t\t\t\t\tcart?.save()\r\n\t\t\t\t\t\t\t\t\t\t\t\tshowDrawer(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<QuickCheckout\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroupID={'quick'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClose={onClose}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonComplete={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClose()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thistory.push(`/checkout/${providerID}/completed`)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tsetDialog('Welcome ðŸŽ‰', 'Please log in first to purchase this product.', [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'OK',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetModal(<Login onNext={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodalClose()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}} />)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t])\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}}>Purchase now</Button>\r\n\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t</Paper>\r\n\t\t\t\t</Container>\r\n\t\t\t</Box>\r\n\t\t</>\r\n\t)\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}