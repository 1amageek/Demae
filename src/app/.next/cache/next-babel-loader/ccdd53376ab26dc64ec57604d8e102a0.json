{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/1amageek/Desktop/Demae/src/app/components/checkout/checkout.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport firebase from 'firebase';\nimport { Box, Paper, TableContainer, Table, TableBody, TableCell, TableRow } from '@material-ui/core';\nimport ErrorIcon from '@material-ui/icons/Error';\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext';\nimport DataLoading from 'components/DataLoading';\nimport CardBrand from 'common/stripe/CardBrand';\nimport { useProcessing } from 'components/Processing';\nimport { useSnackbar } from 'components/Snackbar';\nimport Navigation, { usePush } from 'components/Navigation';\nimport { useUser, useCart } from 'hooks/commerce';\nimport CartItemCell from './CartItemCell';\nimport CardList from './payment/list';\nimport ShippingAddressList from './shipping/list';\nimport Summary from 'components/cart/summary';\nexport default _s((_ref) => {\n  var _defaultShipping$addr, _defaultShipping$addr2, _defaultShipping$addr3, _defaultShipping$addr4, _defaultShipping$addr5, _defaultShipping$addr6, _defaultShipping$addr7;\n\n  _s();\n\n  var {\n    groupID,\n    onClose,\n    onComplete\n  } = _ref;\n  // const { providerID } = props.match.params\n  var [user, isUserLoading] = useUser();\n  var [cart, isCartLoading] = useCart();\n  var cartGroup = cart === null || cart === void 0 ? void 0 : cart.cartGroup(groupID);\n  var defaultShipping = user === null || user === void 0 ? void 0 : user.defaultShipping;\n  var defaultCart = user === null || user === void 0 ? void 0 : user.defaultCard;\n  var [setProcessing] = useProcessing();\n  var [setMessage] = useSnackbar();\n  var [push] = usePush();\n\n  var checkout = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      var _user$defaultCard;\n\n      if (!user) return; // customerID\n\n      var customerID = user.customerID;\n      if (!customerID) return; // defaultShipping\n\n      var defaultShipping = user.defaultShipping;\n      if (!defaultShipping) return; // paymentMethodID\n\n      var paymentMethodID = (_user$defaultCard = user.defaultCard) === null || _user$defaultCard === void 0 ? void 0 : _user$defaultCard.id;\n      if (!paymentMethodID) return;\n      if (!cartGroup) return;\n      cartGroup.shipping = defaultShipping;\n      var data = cartGroup.order(user.id);\n\n      try {\n        setProcessing(true);\n        var checkoutCreate = firebase.functions().httpsCallable('v1-commerce-checkout-create');\n        var response = yield checkoutCreate({\n          order: data,\n          paymentMethodID: paymentMethodID,\n          customerID: customerID\n        });\n        var {\n          error,\n          result\n        } = response.data;\n\n        if (error) {\n          console.error(error);\n          setMessage(\"error\", error.message);\n          setProcessing(false);\n          return;\n        }\n\n        console.log(result);\n        setMessage(\"success\", \"Success\");\n        onComplete();\n      } catch (error) {\n        console.log(error);\n        setMessage(\"error\", \"Error\");\n      }\n\n      setProcessing(false);\n    });\n\n    return function checkout() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (isUserLoading || isCartLoading) {\n    return __jsx(DataLoading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 16\n      }\n    });\n  }\n\n  if (!cartGroup) {\n    return __jsx(Empty, {\n      onClose: onClose,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 16\n      }\n    });\n  }\n\n  var subtotal = new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: cartGroup.currency\n  }).format(cartGroup.subtotal());\n  var tax = new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: cartGroup.currency\n  }).format(cartGroup.tax());\n  return __jsx(Navigation, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }\n  }, __jsx(Paper, {\n    style: {\n      width: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 4\n    }\n  }, __jsx(TableContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 5\n    }\n  }, __jsx(Table, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 6\n    }\n  }, __jsx(TableBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, __jsx(TableRow, {\n    onClick: e => {\n      e.preventDefault();\n      e.stopPropagation();\n      push(__jsx(CardList, {\n        user: user,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 14\n        }\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 8\n    }\n  }, __jsx(TableCell, {\n    style: {\n      width: '90px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }\n  }, __jsx(Box, {\n    color: \"text.secondary\",\n    fontWeight: 700,\n    flexGrow: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 10\n    }\n  }, \"CARD\")), __jsx(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 9\n    }\n  }, defaultCart && __jsx(Box, {\n    display: \"flex\",\n    alignItems: \"center\",\n    flexGrow: 1,\n    style: {\n      width: '180px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 9\n    }\n  }, __jsx(Box, {\n    display: \"flex\",\n    alignItems: \"center\",\n    flexGrow: 1,\n    fontSize: 22,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 12\n    }\n  }, __jsx(\"i\", {\n    className: \"pf \".concat(CardBrand[defaultCart.brand]),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 13\n    }\n  })), __jsx(Box, {\n    justifySelf: \"flex-end\",\n    fontSize: 16,\n    fontWeight: 500,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 12\n    }\n  }, \"\\u2022 \\u2022 \\u2022 \\u2022  \".concat(defaultCart === null || defaultCart === void 0 ? void 0 : defaultCart.last4)))), __jsx(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }\n  }, __jsx(Box, {\n    display: \"flex\",\n    flexGrow: 1,\n    justifyContent: \"flex-end\",\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 10\n    }\n  }, defaultCart ? __jsx(NavigateNextIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 104\n    }\n  }) : __jsx(ErrorIcon, {\n    color: \"secondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 127\n    }\n  })))), __jsx(TableRow, {\n    onClick: e => {\n      e.preventDefault();\n      e.stopPropagation();\n      push(__jsx(ShippingAddressList, {\n        user: user,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 14\n        }\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 8\n    }\n  }, __jsx(TableCell, {\n    style: {\n      width: '90px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 9\n    }\n  }, __jsx(Box, {\n    color: \"text.secondary\",\n    fontWeight: 700,\n    flexGrow: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 10\n    }\n  }, \"SHIPPING\")), __jsx(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }, (defaultShipping === null || defaultShipping === void 0 ? void 0 : defaultShipping.name) && __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 36\n    }\n  }, defaultShipping === null || defaultShipping === void 0 ? void 0 : defaultShipping.name), (defaultShipping === null || defaultShipping === void 0 ? void 0 : (_defaultShipping$addr = defaultShipping.address) === null || _defaultShipping$addr === void 0 ? void 0 : _defaultShipping$addr.state) && __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 46\n    }\n  }, defaultShipping === null || defaultShipping === void 0 ? void 0 : (_defaultShipping$addr2 = defaultShipping.address) === null || _defaultShipping$addr2 === void 0 ? void 0 : _defaultShipping$addr2.state), (defaultShipping === null || defaultShipping === void 0 ? void 0 : (_defaultShipping$addr3 = defaultShipping.address) === null || _defaultShipping$addr3 === void 0 ? void 0 : _defaultShipping$addr3.city) && __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 45\n    }\n  }, defaultShipping === null || defaultShipping === void 0 ? void 0 : (_defaultShipping$addr4 = defaultShipping.address) === null || _defaultShipping$addr4 === void 0 ? void 0 : _defaultShipping$addr4.city), (defaultShipping === null || defaultShipping === void 0 ? void 0 : (_defaultShipping$addr5 = defaultShipping.address) === null || _defaultShipping$addr5 === void 0 ? void 0 : _defaultShipping$addr5.line1) && __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 46\n    }\n  }, \"\".concat(defaultShipping === null || defaultShipping === void 0 ? void 0 : (_defaultShipping$addr6 = defaultShipping.address) === null || _defaultShipping$addr6 === void 0 ? void 0 : _defaultShipping$addr6.line1).concat(defaultShipping === null || defaultShipping === void 0 ? void 0 : (_defaultShipping$addr7 = defaultShipping.address) === null || _defaultShipping$addr7 === void 0 ? void 0 : _defaultShipping$addr7.line2))), __jsx(TableCell, {\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, __jsx(Box, {\n    display: \"flex\",\n    flexGrow: 1,\n    justifyContent: \"flex-end\",\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 10\n    }\n  }, defaultShipping ? __jsx(NavigateNextIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 108\n    }\n  }) : __jsx(ErrorIcon, {\n    color: \"secondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 131\n    }\n  }))))))), __jsx(Box, {\n    padding: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 5\n    }\n  }, __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 6\n    }\n  }, cartGroup.items.map(cartItem => {\n    return __jsx(CartItemCell, {\n      key: cartItem.skuReference.path,\n      groupID: cartGroup.groupID,\n      cartItem: cartItem,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 16\n      }\n    });\n  })), __jsx(Summary, {\n    disabled: isUserLoading,\n    onClick: e => {\n      e.preventDefault();\n      checkout();\n    },\n    items: [{\n      type: 'subtotal',\n      title: 'Subtotal',\n      detail: \"\".concat(subtotal)\n    }, {\n      type: 'tax',\n      title: 'Tax',\n      detail: \"\".concat(tax)\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 6\n    }\n  }))));\n}, \"pGyByVSEp1QLrQiNxNF/7C++Qmo=\", false, function () {\n  return [useUser, useCart, useProcessing, useSnackbar, usePush];\n});\n\nvar Empty = (_ref3) => {\n  _s2();\n\n  var {\n    onClose\n  } = _ref3;\n  useEffect(onClose, []);\n  return __jsx(Box, {\n    display: \"flex\",\n    fontSize: 18,\n    fontWeight: 500,\n    padding: 3,\n    justifyContent: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 13\n    }\n  }, \"The items are empty.\");\n};\n\n_s2(Empty, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n_c = Empty;\n\nvar _c;\n\n$RefreshReg$(_c, \"Empty\");","map":{"version":3,"sources":["/Users/1amageek/Desktop/Demae/src/app/components/checkout/checkout.tsx"],"names":[],"mappings":"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","sourcesContent":["\r\nimport React, { useEffect } from 'react'\r\nimport firebase from 'firebase'\r\nimport { Box, Paper, TableContainer, Table, TableBody, TableCell, TableRow, Avatar, Tooltip, IconButton, Slide, Button } from '@material-ui/core';\r\nimport ErrorIcon from '@material-ui/icons/Error';\r\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext';\r\nimport DataLoading from 'components/DataLoading';\r\nimport CardBrand from 'common/stripe/CardBrand'\r\nimport { useProcessing } from 'components/Processing';\r\nimport { useSnackbar } from 'components/Snackbar'\r\nimport Navigation, { usePush } from 'components/Navigation'\r\nimport { useUser, useCart } from 'hooks/commerce';\r\nimport CartItemCell from './CartItemCell'\r\nimport CardList from './payment/list'\r\nimport ShippingAddressList from './shipping/list'\r\nimport Summary from 'components/cart/summary'\r\n\r\n\r\nexport default ({ groupID, onClose, onComplete }: { groupID: string, onClose: () => void, onComplete: () => void }) => {\r\n\t// const { providerID } = props.match.params\r\n\tconst [user, isUserLoading] = useUser()\r\n\tconst [cart, isCartLoading] = useCart()\r\n\r\n\tconst cartGroup = cart?.cartGroup(groupID)\r\n\tconst defaultShipping = user?.defaultShipping\r\n\tconst defaultCart = user?.defaultCard\r\n\r\n\tconst [setProcessing] = useProcessing()\r\n\tconst [setMessage] = useSnackbar()\r\n\tconst [push] = usePush()\r\n\r\n\tconst checkout = async () => {\r\n\t\tif (!user) return\r\n\r\n\t\t// customerID\r\n\t\tconst customerID = user.customerID\r\n\t\tif (!customerID) return\r\n\r\n\t\t// defaultShipping\r\n\t\tconst defaultShipping = user.defaultShipping\r\n\t\tif (!defaultShipping) return\r\n\r\n\t\t// paymentMethodID\r\n\t\tconst paymentMethodID = user.defaultCard?.id\r\n\t\tif (!paymentMethodID) return\r\n\r\n\t\tif (!cartGroup) return\r\n\r\n\t\tcartGroup.shipping = defaultShipping\r\n\t\tconst data = cartGroup.order(user.id)\r\n\r\n\t\ttry {\r\n\t\t\tsetProcessing(true)\r\n\t\t\tconst checkoutCreate = firebase.functions().httpsCallable('v1-commerce-checkout-create')\r\n\t\t\tconst response = await checkoutCreate({\r\n\t\t\t\torder: data,\r\n\t\t\t\tpaymentMethodID: paymentMethodID,\r\n\t\t\t\tcustomerID: customerID\r\n\t\t\t})\r\n\t\t\tconst { error, result } = response.data\r\n\t\t\tif (error) {\r\n\t\t\t\tconsole.error(error)\r\n\t\t\t\tsetMessage(\"error\", error.message)\r\n\t\t\t\tsetProcessing(false)\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tconsole.log(result)\r\n\t\t\tsetMessage(\"success\", \"Success\")\r\n\t\t\tonComplete()\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(error)\r\n\t\t\tsetMessage(\"error\", \"Error\")\r\n\t\t}\r\n\t\tsetProcessing(false)\r\n\t}\r\n\r\n\r\n\tif (isUserLoading || isCartLoading) {\r\n\t\treturn <DataLoading />\r\n\t}\r\n\r\n\tif (!cartGroup) {\r\n\t\treturn <Empty onClose={onClose} />\r\n\t}\r\n\r\n\tconst subtotal = new Intl.NumberFormat('ja-JP', { style: 'currency', currency: cartGroup.currency }).format(cartGroup.subtotal())\r\n\tconst tax = new Intl.NumberFormat('ja-JP', { style: 'currency', currency: cartGroup.currency }).format(cartGroup.tax())\r\n\r\n\treturn (\r\n\t\t<Navigation>\r\n\t\t\t<Paper style={{ width: '100%' }}>\r\n\t\t\t\t<TableContainer>\r\n\t\t\t\t\t<Table>\r\n\t\t\t\t\t\t<TableBody>\r\n\t\t\t\t\t\t\t<TableRow onClick={(e) => {\r\n\t\t\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\t\tpush(\r\n\t\t\t\t\t\t\t\t\t<CardList user={user!} />\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t<TableCell style={{ width: '90px' }}>\r\n\t\t\t\t\t\t\t\t\t<Box color='text.secondary' fontWeight={700} flexGrow={1}>CARD</Box>\r\n\t\t\t\t\t\t\t\t</TableCell>\r\n\t\t\t\t\t\t\t\t<TableCell>\r\n\t\t\t\t\t\t\t\t\t{defaultCart &&\r\n\t\t\t\t\t\t\t\t\t\t<Box display=\"flex\" alignItems=\"center\" flexGrow={1} style={{ width: '180px' }}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Box display=\"flex\" alignItems=\"center\" flexGrow={1} fontSize={22}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<i className={`pf ${CardBrand[defaultCart!.brand]}`}></i>\r\n\t\t\t\t\t\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t\t\t\t\t\t<Box justifySelf=\"flex-end\" fontSize={16} fontWeight={500}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{`• • • •  ${defaultCart?.last4}`}\r\n\t\t\t\t\t\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</TableCell>\r\n\t\t\t\t\t\t\t\t<TableCell>\r\n\t\t\t\t\t\t\t\t\t<Box display='flex' flexGrow={1} justifyContent=\"flex-end\" alignItems='center'>{defaultCart ? <NavigateNextIcon /> : <ErrorIcon color=\"secondary\" />}</Box>\r\n\t\t\t\t\t\t\t\t</TableCell>\r\n\t\t\t\t\t\t\t</TableRow>\r\n\t\t\t\t\t\t\t<TableRow onClick={(e) => {\r\n\t\t\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\t\tpush(\r\n\t\t\t\t\t\t\t\t\t<ShippingAddressList user={user!} />\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t<TableCell style={{ width: '90px' }}>\r\n\t\t\t\t\t\t\t\t\t<Box color='text.secondary' fontWeight={700} flexGrow={1}>SHIPPING</Box>\r\n\t\t\t\t\t\t\t\t</TableCell>\r\n\t\t\t\t\t\t\t\t<TableCell>\r\n\t\t\t\t\t\t\t\t\t{defaultShipping?.name && <Box>{defaultShipping?.name}</Box>}\r\n\t\t\t\t\t\t\t\t\t{defaultShipping?.address?.state && <Box>{defaultShipping?.address?.state}</Box>}\r\n\t\t\t\t\t\t\t\t\t{defaultShipping?.address?.city && <Box>{defaultShipping?.address?.city}</Box>}\r\n\t\t\t\t\t\t\t\t\t{defaultShipping?.address?.line1 && <Box>{`${defaultShipping?.address?.line1}${defaultShipping?.address?.line2}`}</Box>}\r\n\t\t\t\t\t\t\t\t</TableCell>\r\n\t\t\t\t\t\t\t\t<TableCell align='left'>\r\n\t\t\t\t\t\t\t\t\t<Box display='flex' flexGrow={1} justifyContent=\"flex-end\" alignItems='center'>{defaultShipping ? <NavigateNextIcon /> : <ErrorIcon color=\"secondary\" />}</Box>\r\n\t\t\t\t\t\t\t\t</TableCell>\r\n\t\t\t\t\t\t\t</TableRow>\r\n\t\t\t\t\t\t</TableBody>\r\n\t\t\t\t\t</Table>\r\n\t\t\t\t</TableContainer>\r\n\t\t\t\t<Box padding={2}>\r\n\t\t\t\t\t<Box>\r\n\t\t\t\t\t\t{cartGroup.items.map(cartItem => {\r\n\t\t\t\t\t\t\treturn <CartItemCell key={cartItem.skuReference!.path} groupID={cartGroup.groupID} cartItem={cartItem} />\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</Box>\r\n\t\t\t\t\t<Summary\r\n\t\t\t\t\t\tdisabled={isUserLoading}\r\n\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\t\tcheckout()\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\titems={[{\r\n\t\t\t\t\t\t\ttype: 'subtotal',\r\n\t\t\t\t\t\t\ttitle: 'Subtotal',\r\n\t\t\t\t\t\t\tdetail: `${subtotal}`\r\n\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\ttype: 'tax',\r\n\t\t\t\t\t\t\ttitle: 'Tax',\r\n\t\t\t\t\t\t\tdetail: `${tax}`\r\n\t\t\t\t\t\t}]} />\r\n\t\t\t\t</Box>\r\n\t\t\t</Paper>\r\n\t\t</Navigation>\r\n\t)\r\n}\r\n\r\nconst Empty = ({ onClose }: { onClose: () => void }) => {\r\n\r\n\tuseEffect(onClose, [])\r\n\r\n\treturn (\r\n\t\t<Box display='flex' fontSize={18} fontWeight={500} padding={3} justifyContent='center'>\r\n\t\t\tThe items are empty.\r\n\t\t</Box>\r\n\t)\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}