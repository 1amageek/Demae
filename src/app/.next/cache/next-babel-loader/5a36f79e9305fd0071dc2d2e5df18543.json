{"ast":null,"code":"var _jsxFileName = \"/Users/1amageek/Desktop/Demae/src/app/components/providers/products/skus/SKU.tsx\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { Button, Box, Grid, Avatar, Paper, Container } from '@material-ui/core';\nimport ImageIcon from '@material-ui/icons/Image';\nimport { Provider, Product, SKU, Cart } from 'models/commerce';\nimport DataLoading from 'components/DataLoading';\nimport NotFound from 'components/NotFound';\nimport Login from 'components/Login';\nimport AddBoxIcon from '@material-ui/icons/AddBox';\nimport PaymentIcon from '@material-ui/icons/Payment';\nimport { useDocumentListen } from 'hooks/firestore';\nimport { useCart, useUser } from 'hooks/commerce';\nimport { useDialog } from 'components/Dialog';\nimport { useModal } from 'components/Modal';\nimport { useDrawer } from 'components/Drawer';\nimport { useHistory } from 'react-router-dom';\nimport QuickCheckout from 'components/checkout/checkout';\nexport default (({\n  providerID,\n  productID,\n  skuID\n}) => {\n  const history = useHistory();\n  const [user] = useUser();\n  const [cart] = useCart();\n  const [setDialog] = useDialog();\n  const [setModal, modalClose] = useModal();\n  const [showDrawer, onClose] = useDrawer();\n  const provider = new Provider(providerID);\n  const [product, isProductLoading] = useDocumentListen(Product, provider.products.collectionReference.doc(productID));\n  const [sku, isLoading] = useDocumentListen(SKU, provider.products.doc(productID, Product).skus.collectionReference.doc(skuID));\n  const imageURL = ((sku === null || sku === void 0 ? void 0 : sku.imageURLs()) || []).length > 0 ? sku === null || sku === void 0 ? void 0 : sku.imageURLs()[0] : undefined;\n  const amount = (sku === null || sku === void 0 ? void 0 : sku.price) || 0;\n  const price = new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: (sku === null || sku === void 0 ? void 0 : sku.currency) || 'USD'\n  }).format(amount);\n\n  const withLogin = async (sku, onNext) => {\n    if (user) {\n      onNext(sku);\n    } else {\n      setDialog('Please Login', undefined, [{\n        title: 'Cancel'\n      }, {\n        title: 'OK',\n        variant: 'contained',\n        color: 'primary',\n        handler: () => {\n          setModal(__jsx(Login, {\n            onNext: async user => {\n              onNext(sku);\n              modalClose();\n            },\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 44,\n              columnNumber: 34\n            }\n          }));\n        }\n      }]);\n    }\n  };\n\n  const addSKU = async sku => {\n    withLogin(sku, async sku => {\n      if (!product) return;\n\n      if (user) {\n        if (cart) {\n          cart.addSKU(product, sku, providerID);\n          await cart.save();\n        } else {\n          const cart = new Cart(user.id);\n          cart.addSKU(product, sku, providerID);\n          await cart.save();\n        }\n      }\n    });\n  };\n\n  if (isLoading || isProductLoading) {\n    return __jsx(Container, {\n      maxWidth: \"sm\",\n      disableGutters: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 17\n      }\n    }, __jsx(DataLoading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 5\n      }\n    }));\n  }\n\n  if (!sku || !product) {\n    return __jsx(Container, {\n      maxWidth: \"sm\",\n      disableGutters: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 17\n      }\n    }, __jsx(NotFound, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 5\n      }\n    }));\n  }\n\n  return __jsx(React.Fragment, null, __jsx(Container, {\n    maxWidth: \"sm\",\n    disableGutters: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 4\n    }\n  }, __jsx(Box, {\n    width: \"100%\",\n    height: \"100%\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 5\n    }\n  }, __jsx(Avatar, {\n    variant: \"square\",\n    src: imageURL,\n    alt: sku.name,\n    style: {\n      minHeight: \"200px\",\n      height: '100%',\n      width: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 6\n    }\n  }, __jsx(ImageIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }\n  }))), __jsx(Box, {\n    padding: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 5\n    }\n  }, __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 6\n    }\n  }, __jsx(Box, {\n    fontSize: 22,\n    fontWeight: 800,\n    paddingY: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }\n  }, sku.name), __jsx(Box, {\n    fontSize: 18,\n    fontWeight: 600,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }\n  }, sku.caption), __jsx(Box, {\n    fontSize: 18,\n    fontWeight: 600,\n    color: \"text.secondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }, price), __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }\n  }, sku.description)))), __jsx(Box, {\n    zIndex: 1050,\n    position: \"fixed\",\n    bottom: 58,\n    width: \"100%\",\n    padding: 1,\n    display: \"flex\",\n    justifyContent: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 4\n    }\n  }, __jsx(Container, {\n    maxWidth: \"sm\",\n    disableGutters: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 5\n    }\n  }, __jsx(Paper, {\n    elevation: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 6\n    }\n  }, __jsx(Box, {\n    padding: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 8\n    }\n  }, __jsx(Grid, {\n    item: true,\n    xs: 5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }, __jsx(Button, {\n    fullWidth: true,\n    size: \"large\",\n    style: {\n      fontSize: '13px'\n    },\n    startIcon: __jsx(AddBoxIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 81\n      }\n    }),\n    onClick: e => {\n      e.preventDefault();\n      addSKU(sku);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 10\n    }\n  }, \"Add to cart\")), __jsx(Grid, {\n    item: true,\n    xs: 7,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, __jsx(Button, {\n    fullWidth: true,\n    variant: \"contained\",\n    color: \"primary\",\n    size: \"large\",\n    style: {\n      fontSize: '13px'\n    },\n    startIcon: __jsx(PaymentIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 117\n      }\n    }),\n    onClick: e => {\n      e.preventDefault();\n\n      if (user) {\n        cart === null || cart === void 0 ? void 0 : cart.setSKU(product, sku, 'quick');\n        cart === null || cart === void 0 ? void 0 : cart.save();\n        showDrawer(__jsx(QuickCheckout, {\n          groupID: 'quick',\n          onClose: onClose,\n          onComplete: () => {\n            onClose();\n            history.push(`/checkout/${providerID}/completed`);\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 24\n          }\n        }));\n      } else {\n        setDialog('Welcome ðŸŽ‰', 'Please log in first to purchase this product.', [{\n          title: 'OK',\n          handler: () => {\n            setModal(__jsx(Login, {\n              onNext: () => {\n                modalClose();\n              },\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 136,\n                columnNumber: 34\n              }\n            }));\n          }\n        }]);\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 10\n    }\n  }, \"Purchase now\"))))))));\n});","map":{"version":3,"sources":["/Users/1amageek/Desktop/Demae/src/app/components/providers/products/skus/SKU.tsx"],"names":[],"mappings":";;AAAA,OAAO,KAAP,MAAkB,OAAlB;AACA,SAAS,MAAT,EAAiB,GAAjB,EAAsB,IAAtB,EAA4B,MAA5B,EAAoC,KAApC,EAA2C,SAA3C,QAA4D,mBAA5D;AACA,OAAO,SAAP,MAAsB,0BAAtB;AACA,SAAS,QAAT,EAAmB,OAAnB,EAA4B,GAA5B,EAAiC,IAAjC,QAA6C,iBAA7C;AACA,OAAO,WAAP,MAAwB,wBAAxB;AACA,OAAO,QAAP,MAAqB,qBAArB;AACA,OAAO,KAAP,MAAkB,kBAAlB;AACA,OAAO,UAAP,MAAuB,2BAAvB;AACA,OAAO,WAAP,MAAwB,4BAAxB;AACA,SAAS,iBAAT,QAAkC,iBAAlC;AACA,SAAS,OAAT,EAAkB,OAAlB,QAAiC,gBAAjC;AACA,SAAS,SAAT,QAA0B,mBAA1B;AACA,SAAS,QAAT,QAAyB,kBAAzB;AACA,SAAS,SAAT,QAA0B,mBAA1B;AACA,SAAS,UAAT,QAA2B,kBAA3B;AACA,OAAO,aAAP,MAA0B,8BAA1B;AAGA,gBAAe,CAAC;AAAE,EAAA,UAAF;AAAc,EAAA,SAAd;AAAyB,EAAA;AAAzB,CAAD,KAA+F;AAE7G,QAAM,OAAO,GAAG,UAAU,EAA1B;AACA,QAAM,CAAC,IAAD,IAAS,OAAO,EAAtB;AACA,QAAM,CAAC,IAAD,IAAS,OAAO,EAAtB;AACA,QAAM,CAAC,SAAD,IAAc,SAAS,EAA7B;AACA,QAAM,CAAC,QAAD,EAAW,UAAX,IAAyB,QAAQ,EAAvC;AACA,QAAM,CAAC,UAAD,EAAa,OAAb,IAAwB,SAAS,EAAvC;AAEA,QAAM,QAAQ,GAAa,IAAI,QAAJ,CAAa,UAAb,CAA3B;AACA,QAAM,CAAC,OAAD,EAAU,gBAAV,IAA8B,iBAAiB,CAAU,OAAV,EAAmB,QAAQ,CAAC,QAAT,CAAkB,mBAAlB,CAAsC,GAAtC,CAA0C,SAA1C,CAAnB,CAArD;AACA,QAAM,CAAC,GAAD,EAAM,SAAN,IAAmB,iBAAiB,CAAM,GAAN,EAAW,QAAQ,CAAC,QAAT,CAAkB,GAAlB,CAAsB,SAAtB,EAAiC,OAAjC,EAA0C,IAA1C,CAA+C,mBAA/C,CAAmE,GAAnE,CAAuE,KAAvE,CAAX,CAA1C;AACA,QAAM,QAAQ,GAAG,CAAC,CAAA,GAAG,SAAH,IAAA,GAAG,WAAH,YAAA,GAAG,CAAE,SAAL,OAAoB,EAArB,EAAyB,MAAzB,GAAkC,CAAlC,GAAsC,GAAtC,aAAsC,GAAtC,uBAAsC,GAAG,CAAE,SAAL,GAAiB,CAAjB,CAAtC,GAA4D,SAA7E;AAEA,QAAM,MAAM,GAAG,CAAA,GAAG,SAAH,IAAA,GAAG,WAAH,YAAA,GAAG,CAAE,KAAL,KAAc,CAA7B;AACA,QAAM,KAAK,GAAG,IAAI,IAAI,CAAC,YAAT,CAAsB,OAAtB,EAA+B;AAAE,IAAA,KAAK,EAAE,UAAT;AAAqB,IAAA,QAAQ,EAAE,CAAA,GAAG,SAAH,IAAA,GAAG,WAAH,YAAA,GAAG,CAAE,QAAL,KAAiB;AAAhD,GAA/B,EAAwF,MAAxF,CAA+F,MAA/F,CAAd;;AAEA,QAAM,SAAS,GAAG,OAAO,GAAP,EAAiB,MAAjB,KAA+C;AAChE,QAAI,IAAJ,EAAU;AACT,MAAA,MAAM,CAAC,GAAD,CAAN;AACA,KAFD,MAEO;AACN,MAAA,SAAS,CAAC,cAAD,EAAiB,SAAjB,EAA4B,CACpC;AACC,QAAA,KAAK,EAAE;AADR,OADoC,EAIpC;AACC,QAAA,KAAK,EAAE,IADR;AAEC,QAAA,OAAO,EAAE,WAFV;AAGC,QAAA,KAAK,EAAE,SAHR;AAIC,QAAA,OAAO,EAAE,MAAK;AACb,UAAA,QAAQ,CAAC,MAAC,KAAD;AAAO,YAAA,MAAM,EAAE,MAAO,IAAP,IAAe;AACtC,cAAA,MAAM,CAAC,GAAD,CAAN;AACA,cAAA,UAAU;AACV,aAHQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAD,CAAR;AAIA;AATF,OAJoC,CAA5B,CAAT;AAgBA;AACD,GArBD;;AAuBA,QAAM,MAAM,GAAG,MAAO,GAAP,IAAmB;AACjC,IAAA,SAAS,CAAC,GAAD,EAAM,MAAO,GAAP,IAAc;AAC5B,UAAI,CAAC,OAAL,EAAc;;AACd,UAAI,IAAJ,EAAU;AACT,YAAI,IAAJ,EAAU;AACT,UAAA,IAAI,CAAC,MAAL,CAAY,OAAZ,EAAqB,GAArB,EAA0B,UAA1B;AACA,gBAAM,IAAI,CAAC,IAAL,EAAN;AACA,SAHD,MAGO;AACN,gBAAM,IAAI,GAAG,IAAI,IAAJ,CAAS,IAAI,CAAC,EAAd,CAAb;AACA,UAAA,IAAI,CAAC,MAAL,CAAY,OAAZ,EAAqB,GAArB,EAA0B,UAA1B;AACA,gBAAM,IAAI,CAAC,IAAL,EAAN;AACA;AACD;AACD,KAZQ,CAAT;AAaA,GAdD;;AAgBA,MAAI,SAAS,IAAI,gBAAjB,EAAmC;AAClC,WACC,MAAC,SAAD;AAAW,MAAA,QAAQ,EAAC,IAApB;AAAyB,MAAA,cAAc,MAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,MAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,CADD;AAKA;;AACD,MAAI,CAAC,GAAD,IAAQ,CAAC,OAAb,EAAsB;AACrB,WACC,MAAC,SAAD;AAAW,MAAA,QAAQ,EAAC,IAApB;AAAyB,MAAA,cAAc,MAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,MAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,CADD;AAKA;;AACD,SACC,4BACC,MAAC,SAAD;AAAW,IAAA,QAAQ,EAAC,IAApB;AAAyB,IAAA,cAAc,MAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,GAAD;AACC,IAAA,KAAK,EAAC,MADP;AAEC,IAAA,MAAM,EAAC,MAFR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAIC,MAAC,MAAD;AAAQ,IAAA,OAAO,EAAC,QAAhB;AAAyB,IAAA,GAAG,EAAE,QAA9B;AAAwC,IAAA,GAAG,EAAE,GAAG,CAAC,IAAjD;AAAuD,IAAA,KAAK,EAAE;AAC7D,MAAA,SAAS,EAAE,OADkD;AAE7D,MAAA,MAAM,EAAE,MAFqD;AAG7D,MAAA,KAAK,EAAE;AAHsD,KAA9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKC,MAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IALD,CAJD,CADD,EAaC,MAAC,GAAD;AAAK,IAAA,OAAO,EAAE,CAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,GAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,GAAD;AAAK,IAAA,QAAQ,EAAE,EAAf;AAAmB,IAAA,UAAU,EAAE,GAA/B;AAAoC,IAAA,QAAQ,EAAE,CAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,GAAG,CAAC,IADN,CADD,EAIC,MAAC,GAAD;AAAK,IAAA,QAAQ,EAAE,EAAf;AAAmB,IAAA,UAAU,EAAE,GAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,GAAG,CAAC,OADN,CAJD,EAOC,MAAC,GAAD;AAAK,IAAA,QAAQ,EAAE,EAAf;AAAmB,IAAA,UAAU,EAAE,GAA/B;AAAoC,IAAA,KAAK,EAAC,gBAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,KADF,CAPD,EAUC,MAAC,GAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,GAAG,CAAC,WADN,CAVD,CADD,CAbD,CADD,EAgCC,MAAC,GAAD;AACC,IAAA,MAAM,EAAE,IADT;AAEC,IAAA,QAAQ,EAAC,OAFV;AAGC,IAAA,MAAM,EAAE,EAHT;AAIC,IAAA,KAAK,EAAC,MAJP;AAKC,IAAA,OAAO,EAAE,CALV;AAMC,IAAA,OAAO,EAAC,MANT;AAOC,IAAA,cAAc,EAAC,QAPhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KASC,MAAC,SAAD;AAAW,IAAA,QAAQ,EAAC,IAApB;AAAyB,IAAA,cAAc,MAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,KAAD;AAAO,IAAA,SAAS,EAAE,CAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,GAAD;AAAK,IAAA,OAAO,EAAE,CAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,IAAD;AAAM,IAAA,SAAS,MAAf;AAAgB,IAAA,OAAO,EAAE,CAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,EAAE,EAAE,CAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,MAAD;AAAQ,IAAA,SAAS,MAAjB;AACC,IAAA,IAAI,EAAC,OADN;AAEC,IAAA,KAAK,EAAE;AAAE,MAAA,QAAQ,EAAE;AAAZ,KAFR;AAGC,IAAA,SAAS,EACR,MAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAJF;AAMC,IAAA,OAAO,EAAG,CAAD,IAAM;AACd,MAAA,CAAC,CAAC,cAAF;AACA,MAAA,MAAM,CAAC,GAAD,CAAN;AACA,KATF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADD,CADD,EAaC,MAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,EAAE,EAAE,CAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,MAAC,MAAD;AAAQ,IAAA,SAAS,MAAjB;AACC,IAAA,OAAO,EAAC,WADT;AAEC,IAAA,KAAK,EAAC,SAFP;AAGC,IAAA,IAAI,EAAC,OAHN;AAIC,IAAA,KAAK,EAAE;AAAE,MAAA,QAAQ,EAAE;AAAZ,KAJR;AAKC,IAAA,SAAS,EACR,MAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MANF;AAQC,IAAA,OAAO,EAAG,CAAD,IAAM;AACd,MAAA,CAAC,CAAC,cAAF;;AACA,UAAI,IAAJ,EAAU;AACT,QAAA,IAAI,SAAJ,IAAA,IAAI,WAAJ,YAAA,IAAI,CAAE,MAAN,CAAa,OAAb,EAAsB,GAAtB,EAA2B,OAA3B;AACA,QAAA,IAAI,SAAJ,IAAA,IAAI,WAAJ,YAAA,IAAI,CAAE,IAAN;AACA,QAAA,UAAU,CACT,MAAC,aAAD;AACC,UAAA,OAAO,EAAE,OADV;AAEC,UAAA,OAAO,EAAE,OAFV;AAGC,UAAA,UAAU,EAAE,MAAK;AAChB,YAAA,OAAO;AACP,YAAA,OAAO,CAAC,IAAR,CAAa,aAAa,UAAU,YAApC;AACA,WANF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADS,CAAV;AAUA,OAbD,MAaO;AACN,QAAA,SAAS,CAAC,YAAD,EAAe,+CAAf,EAAgE,CACxE;AACC,UAAA,KAAK,EAAE,IADR;AAEC,UAAA,OAAO,EAAE,MAAK;AACb,YAAA,QAAQ,CAAC,MAAC,KAAD;AAAO,cAAA,MAAM,EAAE,MAAK;AAC5B,gBAAA,UAAU;AACV,eAFQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAD,CAAR;AAGA;AANF,SADwE,CAAhE,CAAT;AAUA;AACD,KAnCF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADD,CAbD,CADD,CADD,CADD,CATD,CAhCD,CADD;AAuGA,CA7KD","sourcesContent":["import React from 'react';\r\nimport { Button, Box, Grid, Avatar, Paper, Container } from '@material-ui/core';\r\nimport ImageIcon from '@material-ui/icons/Image';\r\nimport { Provider, Product, SKU, Cart } from 'models/commerce';\r\nimport DataLoading from 'components/DataLoading';\r\nimport NotFound from 'components/NotFound'\r\nimport Login from 'components/Login'\r\nimport AddBoxIcon from '@material-ui/icons/AddBox';\r\nimport PaymentIcon from '@material-ui/icons/Payment';\r\nimport { useDocumentListen } from 'hooks/firestore';\r\nimport { useCart, useUser } from 'hooks/commerce'\r\nimport { useDialog } from 'components/Dialog'\r\nimport { useModal } from 'components/Modal';\r\nimport { useDrawer } from 'components/Drawer';\r\nimport { useHistory } from 'react-router-dom';\r\nimport QuickCheckout from 'components/checkout/checkout'\r\n\r\n\r\nexport default ({ providerID, productID, skuID }: { providerID: string, productID: string, skuID: string }) => {\r\n\r\n\tconst history = useHistory()\r\n\tconst [user] = useUser()\r\n\tconst [cart] = useCart()\r\n\tconst [setDialog] = useDialog()\r\n\tconst [setModal, modalClose] = useModal()\r\n\tconst [showDrawer, onClose] = useDrawer()\r\n\r\n\tconst provider: Provider = new Provider(providerID)\r\n\tconst [product, isProductLoading] = useDocumentListen<Product>(Product, provider.products.collectionReference.doc(productID))\r\n\tconst [sku, isLoading] = useDocumentListen<SKU>(SKU, provider.products.doc(productID, Product).skus.collectionReference.doc(skuID))\r\n\tconst imageURL = (sku?.imageURLs() || []).length > 0 ? sku?.imageURLs()[0] : undefined\r\n\r\n\tconst amount = sku?.price || 0\r\n\tconst price = new Intl.NumberFormat('ja-JP', { style: 'currency', currency: sku?.currency || 'USD' }).format(amount)\r\n\r\n\tconst withLogin = async (sku: SKU, onNext: (sku: SKU) => void) => {\r\n\t\tif (user) {\r\n\t\t\tonNext(sku)\r\n\t\t} else {\r\n\t\t\tsetDialog('Please Login', undefined, [\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'Cancel',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: 'OK',\r\n\t\t\t\t\tvariant: 'contained',\r\n\t\t\t\t\tcolor: 'primary',\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tsetModal(<Login onNext={async (user) => {\r\n\t\t\t\t\t\t\tonNext(sku)\r\n\t\t\t\t\t\t\tmodalClose()\r\n\t\t\t\t\t\t}} />)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t])\r\n\t\t}\r\n\t}\r\n\r\n\tconst addSKU = async (sku: SKU) => {\r\n\t\twithLogin(sku, async (sku) => {\r\n\t\t\tif (!product) return\r\n\t\t\tif (user) {\r\n\t\t\t\tif (cart) {\r\n\t\t\t\t\tcart.addSKU(product, sku, providerID)\r\n\t\t\t\t\tawait cart.save()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst cart = new Cart(user.id)\r\n\t\t\t\t\tcart.addSKU(product, sku, providerID)\r\n\t\t\t\t\tawait cart.save()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tif (isLoading || isProductLoading) {\r\n\t\treturn (\r\n\t\t\t<Container maxWidth='sm' disableGutters>\r\n\t\t\t\t<DataLoading />\r\n\t\t\t</Container>\r\n\t\t)\r\n\t}\r\n\tif (!sku || !product) {\r\n\t\treturn (\r\n\t\t\t<Container maxWidth='sm' disableGutters>\r\n\t\t\t\t<NotFound />\r\n\t\t\t</Container>\r\n\t\t)\r\n\t}\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Container maxWidth='sm' disableGutters>\r\n\t\t\t\t<Box\r\n\t\t\t\t\twidth=\"100%\"\r\n\t\t\t\t\theight=\"100%\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<Avatar variant=\"square\" src={imageURL} alt={sku.name} style={{\r\n\t\t\t\t\t\tminHeight: \"200px\",\r\n\t\t\t\t\t\theight: '100%',\r\n\t\t\t\t\t\twidth: '100%'\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t\t<ImageIcon />\r\n\t\t\t\t\t</Avatar>\r\n\t\t\t\t</Box>\r\n\t\t\t\t<Box padding={2}>\r\n\t\t\t\t\t<Box>\r\n\t\t\t\t\t\t<Box fontSize={22} fontWeight={800} paddingY={1}>\r\n\t\t\t\t\t\t\t{sku.name}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t<Box fontSize={18} fontWeight={600}>\r\n\t\t\t\t\t\t\t{sku.caption}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t<Box fontSize={18} fontWeight={600} color=\"text.secondary\">\r\n\t\t\t\t\t\t\t{price}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t\t<Box>\r\n\t\t\t\t\t\t\t{sku.description}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t</Box>\r\n\t\t\t\t</Box>\r\n\t\t\t</Container>\r\n\r\n\t\t\t<Box\r\n\t\t\t\tzIndex={1050}\r\n\t\t\t\tposition='fixed'\r\n\t\t\t\tbottom={58}\r\n\t\t\t\twidth='100%'\r\n\t\t\t\tpadding={1}\r\n\t\t\t\tdisplay='flex'\r\n\t\t\t\tjustifyContent='center'\r\n\t\t\t>\r\n\t\t\t\t<Container maxWidth='sm' disableGutters>\r\n\t\t\t\t\t<Paper elevation={3}>\r\n\t\t\t\t\t\t<Box padding={1}>\r\n\t\t\t\t\t\t\t<Grid container spacing={1}>\r\n\t\t\t\t\t\t\t\t<Grid item xs={5}>\r\n\t\t\t\t\t\t\t\t\t<Button fullWidth\r\n\t\t\t\t\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: '13px' }}\r\n\t\t\t\t\t\t\t\t\t\tstartIcon={\r\n\t\t\t\t\t\t\t\t\t\t\t<AddBoxIcon />\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\t\t\t\t\t\taddSKU(sku)\r\n\t\t\t\t\t\t\t\t\t\t}}>Add to cart</Button>\r\n\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t\t<Grid item xs={7}>\r\n\t\t\t\t\t\t\t\t\t<Button fullWidth\r\n\t\t\t\t\t\t\t\t\t\tvariant='contained'\r\n\t\t\t\t\t\t\t\t\t\tcolor='primary'\r\n\t\t\t\t\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: '13px' }}\r\n\t\t\t\t\t\t\t\t\t\tstartIcon={\r\n\t\t\t\t\t\t\t\t\t\t\t<PaymentIcon />\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\t\t\t\t\t\tif (user) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tcart?.setSKU(product, sku, 'quick')\r\n\t\t\t\t\t\t\t\t\t\t\t\tcart?.save()\r\n\t\t\t\t\t\t\t\t\t\t\t\tshowDrawer(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<QuickCheckout\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroupID={'quick'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClose={onClose}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonComplete={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClose()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thistory.push(`/checkout/${providerID}/completed`)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tsetDialog('Welcome ðŸŽ‰', 'Please log in first to purchase this product.', [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'OK',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetModal(<Login onNext={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodalClose()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}} />)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t])\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}}>Purchase now</Button>\r\n\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t</Paper>\r\n\t\t\t\t</Container>\r\n\t\t\t</Box>\r\n\t\t</>\r\n\t)\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}